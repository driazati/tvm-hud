(this["webpackJsonpci-hud"]=this["webpackJsonpci-hud"]||[]).push([[0],{327:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n.n(r),c=n(26),s=n.n(c),i=(n(87),n(88),n(89),n(3)),o=n(9),l=n.n(o),u=n(13),h=n(4),d=n(5),p=n(6),f=n(7),b=n(34),m=n.n(b),j=new(function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,[{key:"url",value:function(e){return"https://ci.pytorch.org/jenkins/"+e+"/api/json"}},{key:"link",value:function(e){return"https://ci.pytorch.org/jenkins/"+e}},{key:"get",value:function(){var e=Object(u.a)(l.a.mark((function e(t,n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n={}),e.next=3,m.a.get(t,{params:n}).then((function(e){r=e})).catch((function(e){}));case 3:if("undefined"===typeof r){e.next=7;break}return e.abrupt("return",r.data);case 7:return e.abrupt("return",null);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"batch_get",value:function(){var e=Object(u.a)(l.a.mark((function e(t,n){var r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n={}),a=t.map((function(e){return m.a.get(e,{params:n}).then((function(e){return{response:e}}),(function(e){return{err:e}}))})),e.next=4,m.a.all(a).then((function(e){r=e})).catch((function(e){}));case 4:if("undefined"===typeof r){e.next=8;break}return e.abrupt("return",r.map((function(e){return e.response?e.response.data:null})));case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"computer",value:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.get(this.url("computer"),t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queue",value:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.get(this.url("queue"),t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"job",value:function(){var e=Object(u.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.get(this.url("job/"+t),n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}()),x=n(1);function g(e){var t=e.currentTime-e.updateTime>e.interval?"disconnected":Object(x.jsxs)(r.Fragment,{children:["connected in ",e.connectedIn,"ms"]}),n=e.updateTime-new Date(0)===0?Object(x.jsx)(r.Fragment,{children:"pending"}):Object(x.jsxs)(r.Fragment,{children:["as of ",e.updateTime.toLocaleTimeString(),"; ",t]});return Object(x.jsxs)("span",{className:t,children:["(",n,")"]})}function v(e){return e.replace(/^pytorch-/,"").replace(/-trigger$/,"").replace(/^private\//,"").replace(/^ccache-cleanup-/,"").replace(/_ci\/circleci: /,"").replace(/AAA_/,"")}function y(e){var t=new Date(e);return(new Date).toLocaleDateString()===t.toLocaleDateString()?t.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}):t.toLocaleString("en-US",{month:"short",day:"numeric",weekday:"short"})}function O(e){var t=new Date(e),n=new Date;return function(e){var t=Math.floor(e/3600),n=Math.floor((e-3600*t)/60);e=e-3600*t-60*n;var r="";return 0!==t&&(r=t+":"),0===n&&""===r||(r+=(n=n<10&&""!==r?"0"+n:String(n))+":"),""===r?r=e+"s":r+=e<10?"0"+e:String(e),r}(Math.floor((n-t)/1e3))}function _(e){var t;return null!==(t=RegExp("^https://ci\\.pytorch\\.org/jenkins/job/([^/]+)/job/([^/]+)/").exec(e))?t[1].replace(/-builds$/,"")+"/"+v(t[2]):null!==(t=RegExp("https://ci\\.pytorch\\.org/jenkins/job/([^/]+)/").exec(e))?t[1]:e}var w={"linux-cpu":17,"linux-bigcpu":68,"linux-gpu":228,"linux-tc-gpu":228,"linux-multigpu":456,"linux-cpu-ccache":17,"win-cpu":34,"win-gpu":114,osx:13900/30/24,master:17,packet:40,rocm:0,"tc-gpu":114};function k(e){return void 0===e?"?":(e/100).toLocaleString("en-US",{style:"currency",currency:"USD"})}var S=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={computer:[],currentTime:new Date,updateTime:new Date(0),connectedIn:0},r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.update(),this.interval=setInterval(this.update.bind(this),this.props.interval)}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"update",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Date,this.setState({currentTime:t}),e.next=4,j.computer({tree:"computer[\n                offline,\n                idle,\n                displayName,\n                assignedLabels[name],\n                executors[\n                  currentExecutable[\n                    timestamp,\n                    estimatedDuration,\n                    url,\n                    building\n                  ],\n                  idle\n                ]\n              ]".replace(/\s+/g,"")});case 4:(n=e.sent).updateTime=new Date,n.connectedIn=n.updateTime-t,this.setState(n);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=new Map;this.state.computer.forEach((function(t){var n=function(e){var t=e.displayName;return/^c5.xlarge-i-.*$/.test(t)?"linux-cpu":/^c5.4xlarge-i-.*$/.test(t)?"linux-bigcpu":/^g3.8xlarge-i-.*$/.test(t)?e.assignedLabels.some((function(e){return"tc_gpu"===e.name}))?"linux-tc-gpu":"linux-gpu":/^g3.16xlarge-i-.*$/.test(t)?"linux-multigpu":/^worker-c5-xlarge-.*$/.test(t)?"linux-cpu-ccache":/^worker-macos-high-sierra-.*$/.test(t)?"osx":/^worker-win-c5.2xlarge-i-.*$/.test(t)?"win-cpu":/^worker-win-g3.4xlarge-i-.*$/.test(t)?"win-gpu":/^worker-osuosl-ppc64le-cpu-.*$/.test(t)?"ppc":/^worker-packet-type-1-.*$/.test(t)?"packet":/^jenkins-worker-rocm-.*$/.test(t)?"rocm":/^worker-g3-4xlarge-.*$/.test(t)?"tc-gpu":t}(t),r=e.get(n);void 0===r&&(r={busy:0,total:0}),t.offline||(r.total++,t.idle||r.busy++),e.set(n,r)}));var t=0;e.forEach((function(e,n){var r=w[n];void 0!==r&&(e.totalCost=r*e.total,t+=e.totalCost)}));var n=Object(i.a)(e.entries()).sort().map((function(e){var t=k(e[1].totalCost);return Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{children:e[0]}),Object(x.jsxs)("td",{children:[e[1].busy," / ",e[1].total]}),Object(x.jsxs)("td",{className:"ralign",children:[t,"/hr"]})]},e[0])})),r=this.state.computer.filter((function(e){return!e.idle&&"master"!==e.displayName&&e.executors.length>0&&e.executors[0].currentExecutable}));r.sort((function(e,t){return e.executors[0].currentExecutable.timestamp-t.executors[0].currentExecutable.timestamp}));var a=r.map((function(e){var t=e.executors[0].currentExecutable;return Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{className:"left-cell",children:O(t.timestamp)}),Object(x.jsx)("td",{children:Object(x.jsx)("a",{href:t.url,children:_(t.url)})})]},e.displayName)})),c=new Map;return r.forEach((function(e){var t=e.executors[0].currentExecutable,n=_(t.url),r=c.get(n);void 0===r&&(r={total:0,cumulative_time:0},c.set(n,r)),r.total++,r.cumulative_time+=function(e){var t=new Date(e);return(new Date-t)/1e3}(t.timestamp)})),Object(x.jsxs)("div",{children:[Object(x.jsxs)("h2",{children:["Computers"," ",Object(x.jsx)(g,{interval:this.props.interval,currentTime:this.state.currentTime,updateTime:this.state.updateTime,connectedIn:this.state.connectedIn})]}),Object(x.jsx)("table",{children:Object(x.jsx)("tbody",{children:Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{children:Object(x.jsxs)("table",{children:[Object(x.jsx)("tbody",{children:n}),Object(x.jsx)("tfoot",{children:Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{}),Object(x.jsxs)("td",{className:"ralign",colSpan:"2",children:[k(24*t*30),"/mo"]})]})})]})}),Object(x.jsx)("td",{className:"right-cell",children:Object(x.jsx)("table",{children:Object(x.jsx)("tbody",{children:a})})})]})})})]})}}]),n}(r.Component),C=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={items:[],currentTime:new Date,updateTime:new Date(0),connectedIn:0},r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.update(),this.interval=setInterval(this.update.bind(this),this.props.interval)}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"update",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Date,this.setState({currentTime:t}),e.next=4,j.queue();case 4:(n=e.sent).updateTime=new Date,n.connectedIn=n.updateTime-t,this.setState(n);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=new Map;this.state.items.forEach((function(t){var n=function(e){return e.replace(/^Waiting for next available executor on/,"Needs").replace(/docker&&cpu&&ccache/,"linux-cpu-ccache").replace(/[^ ]+cpu_ccache.+/,"linux-cpu-ccache").replace(/docker&&cpu&&!ccache/,"linux-cpu").replace(/docker&&cpu/,"linux-cpu-any").replace(/docker&&gpu/,"linux-gpu").replace(/docker&&bigcpu/,"linux-bigcpu").replace(/windows&&cpu/,"windows-cpu").replace(/windows&&gpu/,"windows-gpu").replace(/g3.8xlarge-i-[^ ]+/,"linux-gpu").replace(/g3.16xlarge-i-[^ ]+/,"linux-multigpu").replace(/worker-win-c5.2xlarge-i-[^ ]+/,"windows-cpu").replace(/worker-win-g3.4xlarge-i-[^ ]+/,"windows-gpu")}(t.why),r=e.get(n);void 0===r&&(r={total:0},e.set(n,r)),r.total++}));var t=Object(i.a)(e.entries()).sort().map((function(e){var t=e[0],n=e[1];return Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{style:{textAlign:"right",paddingRight:15},children:n.total}),Object(x.jsx)("th",{children:t})]},t)})),n=new Map;this.state.items.forEach((function(e){var t=_(e.task.url),r=n.get(t);void 0===r&&(r={total:0},n.set(t,r)),r.total++}));var r=Object(i.a)(n.entries()).sort((function(e,t){return t[1].total-e[1].total})).slice(0,10).map((function(e){var t=e[0],n=e[1];return Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{style:{textAlign:"right",paddingRight:15},children:n.total}),Object(x.jsx)("th",{children:t})]},t)}));return Object(x.jsxs)("div",{children:[Object(x.jsxs)("h2",{children:["Queue"," ",Object(x.jsx)(g,{interval:this.props.interval,connectedIn:this.state.connectedIn,currentTime:this.state.currentTime,updateTime:this.state.updateTime})]}),Object(x.jsx)("table",{children:Object(x.jsx)("tbody",{children:Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{width:300,style:{textOverflow:"clip",maxWidth:300,overflow:"hidden"},children:Object(x.jsx)("table",{children:Object(x.jsx)("tbody",{children:t})})}),Object(x.jsx)("td",{className:"right-cell",width:300,children:Object(x.jsx)("table",{children:Object(x.jsxs)("tbody",{children:[r,Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{}),Object(x.jsx)("th",{children:n.size>10?"...":""})]})]})})})]})})})]})}}]),n}(r.Component),N=n(11),I=n(52),L=n(53),E=n.n(L),R=n(31),D=["_","setup","caffe2-py2-cuda9.0-cudnn7-windows","caffe2-py2-devtoolset7-rocmrpm-centos7.5","py3.6-clang7-rocmdeb-ubuntu16.04","win-ws2016-cuda9-cudnn7-py3","pytorch_linux_xenial_py2_7_9","pytorch_linux_xenial_cuda9_cudnn7_py3","pytorch_linux_xenial_py3_clang5_asan","pytorch_linux_xenial_py3_6_gcc5_4","pytorch_libtorch_linux_xenial_cuda9_cudnn7_py3","caffe2_py2_mkl_ubuntu16_04","caffe2_py3_5_cuda10_1_cudnn7_ubuntu16_04","caffe2_onnx_py2_gcc5_ubuntu16_04","caffe2_onnx_main_py3_6_clang7_ubuntu16_04","caffe2_onnx_ort1_py3_6_clang7_ubuntu16_04","caffe2_onnx_ort2_py3_6_clang7_ubuntu16_04","caffe2_py2_clang7_ubuntu16_04","caffe2_cmake_cuda9_0_cudnn7_ubuntu16_04","caffe2_py3_6_devtoolset7_cuda9_0_cudnn7_centos7","binary_linux_manywheel_2_7mu_cpu_devtoolset7","binary_linux_libtorch_2_7m_cpu_devtoolset7","binary_linux_libtorch_2_7m_cpu_gcc5_4_cxx11-abi","binary_linux_libtorch_2_7_cpu","caffe2_py2_android_ubuntu16_04","caffe2_py2_system_macos10_13","pytorch_macos_10_13_py3","pytorch_macos_10_13_cuda9_2_cudnn7_py3","pytorch-linux_xenial_py3_clang5_android_ndk_r19c_x86_32_build","pytorch-linux-xenial-py3-clang5-android-ndk-r19c-gradle-build-x86_32","pytorch_ios_10_2_1_x86_64_build","pytorch_ios_10_2_1_arm64_build","pytorch_linux_backward_compatibility_check_test","pytorch_xla_linux_xenial_py3_6_clang7","pytorch_python_doc_push","pytorch_cpp_doc_push"],A=["binary_linux_manywheel_2_7mu_cpu_devtoolset7_build","binary_linux_manywheel_3_7m_cu100_devtoolset7_build","binary_linux_conda_2_7_cpu_devtoolset7_build","binary_macos_wheel_3_6_cpu_build","binary_macos_conda_2_7_cpu_build","binary_macos_libtorch_2_7_cpu_build","binary_linux_manywheel_2_7mu_cpu_devtoolset7_test","binary_linux_manywheel_3_7m_cu100_devtoolset7_test","binary_linux_conda_2_7_cpu_devtoolset7_test","binary_linux_libtorch_2_7m_cpu_devtoolset7_shared-with-deps_build","binary_linux_libtorch_2_7m_cpu_devtoolset7_shared-with-deps_test","binary_linux_libtorch_2_7m_cpu_gcc5_4_cxx11-abi_shared-with-deps_build","binary_linux_libtorch_2_7m_cpu_gcc5_4_cxx11-abi_shared-with-deps_test"];function T(e){return"SUCCESS"===e||"success"===e}function U(e){return"FAILURE"===e||"failure"===e||"error"===e||"timed_out"===e}function P(e){var t=e.jobName;return/caffe2-builds/.test(e.url)?"caffe2-"+t:t}var B=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state=r.initialState(),r}return Object(d.a)(n,[{key:"initialState",value:function(){var e=localStorage.getItem("prefs"),t={};return e&&(t=JSON.parse(e)),"showStale"in t||(t.showStale=!1),"username"in t||(t.username=""),"showNotifications"in t||(t.showNotifications=!0),{builds:[],known_jobs:[],currentTime:new Date,updateTime:new Date(0),showStale:t.showStale,username:t.username,showNotifications:t.showNotifications}}},{key:"componentDidMount",value:function(){this.update(),this.interval=setInterval(this.update.bind(this),this.props.interval),this.state.showNotifications&&"granted"!==Notification.permission&&Notification.requestPermission()}},{key:"componentDidUpdate",value:function(e){localStorage.setItem("prefs",JSON.stringify({showNotifications:this.state.showNotifications,showStale:this.state.showStale,username:this.state.username})),this.props.job!==e.job&&(this.setState(this.initialState()),this.update())}},{key:"update",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n,r,a,c,s,o,h,d=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h=function(e,t){var n=D.some((function(t){return v(e).startsWith(t)})),r=D.some((function(e){return v(t).startsWith(e)}));return n<r?1:n>r||e<t?-1:e>t?1:0},s=function(e){e.subBuilds.forEach((function e(t){t.build&&"com.tikal.jenkins.plugins.multijob.MultiJobBuild"===t.build._class?t.build.subBuilds.forEach(e):c.add(P(t))}))},a=function(){return(a=Object(u.a)(l.a.mark((function e(){var t,r,a,c,s,i,o,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=function(e,n){var a=r[n].commitId;if(e)for(var c in e){var s=e[c];t[a].hasOwnProperty(c)||(t[a][c]={duration:"0",result:s.status,url:s.build_url})}},t={},r=[],c=Object(N.a)(n.builds);try{for(c.s();!(s=c.n()).done;)for(i=s.value,o=0;o<i.changeSet.items.length;o++)u=i.changeSet.items[o].commitId,t.hasOwnProperty(u)||(t[u]={}),r.push({url:"https://s3.amazonaws.com/ossci-job-status/combined/"+u+".json",commitId:u})}catch(l){c.e(l)}finally{c.f()}return e.next=7,j.batch_get(r.map((function(e){return e.url})));case 7:return e.sent.forEach(a),e.abrupt("return",t);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)},r=function(){return a.apply(this,arguments)},t=new Date,this.setState({currentTime:t}),e.next=9,j.job(this.props.job,{tree:"builds[\n                  url,\n                  number,\n                  duration,\n                  timestamp,\n                  result,\n                  actions[parameters[name,value],\n                  causes[shortDescription]],\n                  changeSet[items[commitId,comment,msg]],\n                  subBuilds[\n                    result,jobName,url,duration,\n                    build[\n                      subBuilds[\n                        result,jobName,url,duration,\n                        build[\n                          subBuilds[result,jobName,url,duration]\n                        ]\n                      ]\n                    ]\n                  ]\n               ]".replace(/\s+/g,"")});case 9:n=e.sent,e.next=16;break;case 12:return 1,e.next=15,j.job(this.props.job,{depth:1});case 15:n=e.sent;case 16:return n.updateTime=new Date,n.connectedIn=n.updateTime-t,void 0!==n.allBuilds&&(n.builds=n.allBuilds),e.next=21,r();case 21:n.github_commit_statuses=e.sent,c=new Set,"binary"!==(o=this.props.mode)&&n.builds.forEach(s),n.github_commit_statuses&&Object.keys(n.github_commit_statuses).forEach((function(e){var t=n.github_commit_statuses[e];Object.keys(t).forEach((function(e){if("binary"!==o){for(var t=0;t<A.length;t++)if(e.endsWith(A[t])){c.add("_"+e);break}e.includes("binary_")||e.includes("smoke_")||c.add("_"+e)}else if(e.includes("binary_")||e.includes("smoke_")){for(var n=!1,r=0;r<A.length;r++)if(e.endsWith(A[r])){n=!0;break}n||c.add("_"+e)}}))})),n.known_jobs=Object(i.a)(c.values()).sort(h),n.builds.forEach((function(e){var t=new Map;function r(){return(r=Object(u.a)(l.a.mark((function e(r){var a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.changeSet.items.length>0)for(a=function(){var e=r.changeSet.items[c].commitId;n.github_commit_statuses&&Object.keys(n.github_commit_statuses[e]).forEach((function(r){var a=n.github_commit_statuses[e][r];t.set("_"+r,{duration:a.duration,result:a.result,url:a.url})}))},c=0;c<r.changeSet.items.length;c++)a();case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.subBuilds.forEach((function e(n){n.build&&"com.tikal.jenkins.plugins.multijob.MultiJobBuild"===n.build._class?n.build.subBuilds.forEach(e):t.set(P(n),n)})),function(e){r.apply(this,arguments)}(e),e.sb_map=t})),10,this.props.job.includes("master")&&function(){var e=new Set,t=new Map;n.known_jobs.forEach((function(t){"pytorch_doc_push"!==t&&"__dr.ci"!==t&&(t.includes("nightlies")||e.add(t))}));for(var r=0;r<n.builds.length&&!(r>10)&&e.size;r++){n.builds[r].sb_map.forEach((function(n,r){if(e.has(r))if(U(n.result)){var a=t.get(r)||0;a++,t.set(r,a)}else T(n.result)&&e.delete(r);else;}))}t.forEach((function(e,n){e<=1&&t.delete(n)})),n.consecutive_failure_count=t,d.state.consecutive_failure_count&&d.state.consecutive_failure_count.forEach((function(e,n){t.has(n)||new Notification("\u2705 "+d.props.job,{body:v(n)})})),t.forEach((function(e,t){d.state.consecutive_failure_count&&!d.state.consecutive_failure_count.has(t)&&new Notification("\u274c "+d.props.job,{body:v(t)})}))}(),this.setState(n);case 31:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;var t=this.state.builds,n=this.state.consecutive_failure_count,a=this.state.known_jobs,c=a.map((function(e){return Object(x.jsx)("th",{className:"rotate",children:Object(x.jsxs)("div",{className:(D.some((function(t){return v(e).startsWith(t)}))?"pr-header":"master-only-header")+" "+(n.has(e)?"failing-header":""),children:[D.some((function(t){return v(e).startsWith(t)}))?"":"\u2022 ",v(e)]})},e)})),s=I.scaleLinear().rangeRound([0,100]);s.domain([0,I.max(t,(function(e){return e.duration}))]);var i=new Set,o=t.map((function(t){var n=t.sb_map;var c=0,o=!1,l=!1,u=!1,h=a.map((function(t){var a,s,i=n.get(t),h=Object(x.jsx)(r.Fragment,{});if(void 0!==i){u=!0;var d=E()(i.duration),p="short-perf-test-gpu"===(s=P(i))?"linux-gpu":"doc-push"===s?"linux-cpu":/-win/.test(s)?/-test/.test(s)&&/-cuda/.test(s)?"win-gpu":"win-cpu":/-macos/.test(s)?"osx":/-linux/.test(s)||/-ubuntu/.test(s)||/-centos/.test(s)||/-xenial/.test(s)?/cuda/.test(s)?/-multigpu-test/.test(s)?"linux-multigpu":/-test/.test(s)?"linux-gpu":"linux-cpu":/-rocm/.test(s)?/-test/.test(s)?"rocm":"linux-bigcpu":"linux-cpu":"unknown",f=0;if("unknown"===p?o=!0:f=Math.ceil(w[p]*d/1e3/60/60),c+=f,i.result||(l=!0),"perf"===e.props.mode)h=function(e,t){return Object(x.jsxs)(r.Fragment,{children:[Object(x.jsx)("span",{className:T(t)?"ok-duration":"suspect-duration",children:E()(e.duration)/1e3}),"\xa0\xa0"]})}(i,i.result);else if("cost"===e.props.mode)h=Object(x.jsxs)(r.Fragment,{children:["unknown"===p?"?":f,"\xa0\xa0"]});else{var b=i.url;/^https?:\/\//.test(b)?b.includes("jenkins")&&(b+="/console"):b=j.link(b+"/console"),h=Object(x.jsx)("a",{href:b,className:"icon",target:"_blank",rel:"noreferrer",alt:P(i),children:(a=i.result,T(a)?Object(x.jsx)("span",{role:"img",style:{color:"green"},"aria-label":"passed",children:"0"}):U(a)?Object(x.jsx)("span",{role:"img",style:{color:"red"},"aria-label":"failed",children:"X"}):function(e){return"ABORTED"===e||"cancelled"===e}(a)?Object(x.jsx)("span",{role:"img",style:{color:"gray"},"aria-label":"cancelled",children:"."}):function(e){return!e||"pending"===e}(a)?Object(x.jsx)("span",{className:"animate-flicker",role:"img",style:{color:"goldenrod"},"aria-label":"in progress",children:"?"}):a)})}}return Object(x.jsx)(R.a,{overlay:t,mouseLeaveDelay:0,placement:"rightTop",destroyTooltipOnHide:!0,children:Object(x.jsx)("td",{className:"icon-cell",style:{textAlign:"right",fontFamily:"sans-serif",padding:0},children:h},t)},t)}));function d(e){var t=e.match(/\(#(\d+)\)/);return t?Object(x.jsx)(r.Fragment,{children:Object(x.jsxs)("a",{href:"https://github.com/pytorch/pytorch/pull/"+t[1],target:"_blank",rel:"noreferrer",children:["#",t[1]]})}):Object(x.jsx)(r.Fragment,{})}function p(e){var t=Object(x.jsx)("em",{children:"Manually triggered rebuild."});return void 0===e.actions?t:e.actions.filter((function(e){return void 0!==e.causes})).map((function(e,t){return e.causes.map((function(e,t){return Object(x.jsxs)("em",{children:[e.shortDescription,". "]},t)}))}))}var f,b,m=t.actions.some((function(e){return void 0!==e.causes&&e.causes.some((function(e){return"com.sonyericsson.rebuild.RebuildCause"===e._class}))})),g=t.actions.some((function(e){return void 0!==e.causes&&e.causes.some((function(e){return"org.jenkinsci.plugins.ghprb.GhprbCause"===e._class||"hudson.model.Cause$UpstreamCause"===e._class&&/-pull-request$/.test(e.upstreamProject)}))})),v="",O="",_=!1;if(m)O=p(t);else if(g){var S=function(e){var t=e.actions.find((function(e){return"org.jenkinsci.plugins.ghprb.GhprbParametersAction"===e._class}));return void 0===t&&(t=e.actions.find((function(e){return"com.tikal.jenkins.plugins.multijob.MultiJobParametersAction"===e._class}))),void 0===t?new Map:new Map(t.parameters.map((function(e){return[e.name,e.value]})))}(t),C=S.get("ghprbPullTitle");if(f=S.get("ghprbPullLink"),b=S.get("ghprbPullId"),v=S.get("ghprbPullAuthorLogin"),O=C,i.has(b)){if(!e.state.showStale)return Object(x.jsx)(r.Fragment,{},t.number);_=!0}if(""!==e.state.username&&e.state.username!==v)return Object(x.jsx)(r.Fragment,{},t.number);i.add(b)}else{var N=t.changeSet;v=function(e){var t=e.actions.find((function(e){return"hudson.model.CauseAction"===e._class}));if(void 0===t)return"(unknown)";var n=t.causes.find((function(e){return"com.cloudbees.jenkins.GitHubPushCause"===e._class}));if(void 0===n)return"";var r=n.shortDescription.match(/Started by GitHub push by (.+)/);return null===r?n.shortDescription:r[1]}(t),O=0===N.items.length?p(t):N.items.slice().reverse().map((function(e){return Object(x.jsxs)("div",{children:[d(e.comment)," ",(t=e.msg,t.replace(/\(#[0-9]+\)/,""))," ",Object(x.jsx)("code",{children:Object(x.jsx)("a",{href:"https://github.com/pytorch/pytorch/commit/"+e.commitId,target:"_blank",rel:"noreferrer",children:e.commitId.slice(0,7)})})]},e.commitId);var t}))}var I=y(t.timestamp);return u?Object(x.jsxs)("tr",{className:_?"stale":"",children:[Object(x.jsx)("th",{className:"left-cell",children:Object(x.jsx)("a",{href:t.url,target:"_blank",rel:"noreferrer",children:t.number})}),Object(x.jsx)("th",{className:"left-cell",children:Object(x.jsx)("a",{href:f,target:"_blank",rel:"noreferrer",children:b?"#"+b:""})}),Object(x.jsx)("td",{className:"left-cell",children:I}),h,Object(x.jsx)("td",{className:"right-cell bar-number",children:Math.floor(t.duration/1e3/60)}),Object(x.jsx)("td",{children:Object(x.jsx)("svg",{width:100,height:10,children:Object(x.jsx)("rect",{className:"bar",x:"0",y:"0",width:s(t.duration),height:10})})}),Object(x.jsxs)("td",{className:"right-cell",style:{textAlign:"right"},children:[l?"\u2265 ":"",k(c),o?"?":""]}),Object(x.jsx)("td",{className:"right-cell",children:v}),Object(x.jsx)("td",{className:"right-cell",children:O})]},t.number):Object(x.jsx)(r.Fragment,{})}));return Object(x.jsxs)("div",{children:[Object(x.jsxs)("h2",{children:[Object(x.jsx)("a",{href:j.link("job/"+this.props.job),target:"_blank",rel:"noreferrer",children:this.props.job})," ","history"," ",Object(x.jsx)(g,{interval:this.props.interval,connectedIn:this.state.connectedIn,currentTime:this.state.currentTime,updateTime:this.state.updateTime})]}),Object(x.jsx)("div",{style:{color:"#909"},children:"\u2022 Purple bulleted jobs run on master only."}),Object(x.jsx)("div",{children:Object(x.jsxs)("ul",{className:"menu",children:[Object(x.jsxs)("li",{children:[Object(x.jsx)("input",{type:"checkbox",name:"show-stale",checked:this.state.showStale,onChange:function(t){e.setState({showStale:t.target.checked})}}),Object(x.jsx)("label",{htmlFor:"show-stale",children:"Show stale builds of PRs"})]}),Object(x.jsxs)("li",{children:[Object(x.jsx)("input",{type:"text",name:"username",value:this.state.username,onChange:function(t){e.setState({username:t.target.value})}}),Object(x.jsx)("label",{htmlFor:"username",style:{backgroundColor:"white",position:"relative",zIndex:3},children:"Show builds from this user only"})]}),Object(x.jsxs)("li",{children:[Object(x.jsx)("input",{type:"checkbox",name:"show-notifications",checked:this.state.showNotifications,onChange:function(t){return e.setState({showNotifications:t.target.checked})}}),Object(x.jsxs)("label",{htmlFor:"show-notifications",children:["Show notifications on master failure","denied"===Notification.permission?Object(x.jsxs)(r.Fragment,{children:[" ",Object(x.jsx)("strong",{children:"(WARNING: notifications are currently denied)"})]}):""]})]})]})}),Object(x.jsxs)("table",{className:"buildHistoryTable",children:[Object(x.jsx)("thead",{children:Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{className:"left-cell",children:"J#"}),Object(x.jsx)("th",{className:"left-cell",children:"PR#"}),Object(x.jsx)("th",{className:"left-cell",children:"Date"}),c,Object(x.jsx)("th",{className:"right-cell",colSpan:"2",children:"Latency (min)"}),Object(x.jsx)("th",{className:"right-cell",children:"Cost"}),Object(x.jsx)("th",{className:"right-cell",children:"User"}),Object(x.jsx)("th",{className:"right-cell",children:"Description"})]})}),Object(x.jsx)("tbody",{children:o})]})]})}}]),n}(r.Component),M={pytorch:[{regex:/Lint/,name:"Lint Jobs"},{regex:/(\(periodic-pytorch)|(ci\/circleci: periodic_pytorch)|(^periodic-)/,name:"Periodic Jobs"},{regex:/(Linux CI \(pytorch-linux-)|(^linux-)/,name:"Linux GitHub Actions"},{regex:/(Add annotations )|(Close stale pull requests)|(Label PRs & Issues)|(Triage )|(Update S3 HTML indices)|(codecov\/project)|(Facebook CLA Check)|(auto-label-rocm)/,name:"Annotations and labeling"},{regex:/(ci\/circleci: docker-pytorch-)|(ci\/circleci: ecr_gc_job_)|(ci\/circleci: docker_for_ecr_gc_build_job)|(Garbage Collect ECR Images)/,name:"Docker"},{regex:/(Windows CI \(pytorch-)|(^win-)/,name:"Windows GitHub Actions"},{regex:/ \/ calculate-docker-image/,name:"GitHub calculate-docker-image"},{regex:/docker-builds/,name:"CI Docker Image Builds"},{regex:/ci\/circleci: pytorch_ios_/,name:"ci/circleci: pytorch_ios"},{regex:/^ios-/,name:"iOS Github Actions"},{regex:/^macos-/,name:"macOS Github Actions"},{regex:/(ci\/circleci: pytorch_parallelnative_)|(ci\/circleci: pytorch_paralleltbb_)|(paralleltbb-linux-)|(parallelnative-linux-)/,name:"Parallel"},{regex:/(ci\/circleci: pytorch_cpp_doc_build)|(ci\/circleci: pytorch_cpp_doc_test)|(pytorch_python_doc_build)|(pytorch_doc_test)/,name:"Docs"},{regex:/ci\/circleci: pytorch_linux_bionic_cuda10_2_cudnn7_py3_9_gcc7_/,name:"ci/circleci: pytorch_linux_bionic_cuda10_2_cudnn7_py3_9_gcc7"},{regex:/ci\/circleci: pytorch_linux_xenial_cuda10_2_cudnn7_py3_/,name:"ci/circleci: pytorch_linux_xenial_cuda10_2_cudnn7_py3"},{regex:/ci\/circleci: pytorch_linux_xenial_cuda11_1_cudnn8_py3_gcc7_/,name:"ci/circleci: pytorch_linux_xenial_cuda11_1_cudnn8_py3_gcc7"},{regex:/(ci\/circleci: pytorch_linux_xenial_py3_clang5_android_ndk_r19c_)|(ci\/circleci: pytorch-linux-xenial-py3-clang5-android-ndk-r19c-)/,name:"ci/circleci: pytorch_linux_xenial_py3_clang5_android_ndk"},{regex:/ci\/circleci: pytorch_linux_xenial_py3_6_gcc7_build/,name:"ci/circleci: pytorch_linux_xenial_py3_clang5_asan_build"},{regex:/ci\/circleci: pytorch_linux_xenial_py3_clang5_mobile_/,name:"ci/circleci: pytorch_linux_xenial_py3_clang5_mobile"},{regex:/ci\/circleci: pytorch_linux_xenial_py3_clang7_onnx_/,name:"ci/circleci: pytorch_linux_xenial_py3_clang7_onnx"},{regex:/ci\/circleci: pytorch_linux_xenial_py3_clang5_asan_/,name:"ci/circleci: pytorch_linux_xenial_py3_clang5_asan"},{regex:/ci\/circleci: pytorch_linux_xenial_py3_6_gcc7_/,name:"ci/circleci: pytorch_linux_xenial_py3_6_gcc7"},{regex:/ci\/circleci: pytorch_macos_10_13_py3_/,name:"ci/circleci: pytorch_macos_10_13_py3"},{regex:/ci\/circleci: pytorch_linux_xenial_py3_6_gcc5_4_/,name:"ci/circleci: pytorch_linux_xenial_py3_6_gcc5_4"},{regex:/ci\/circleci: binary_linux_/,name:"ci/circleci: binary_linux"},{regex:/ci\/circleci: binary_macos_/,name:"ci/circleci: binary_macos"},{regex:/ci\/circleci: binary_windows_/,name:"ci/circleci: binary_windows"},{regex:/(pytorch-linux-bionic-rocm)|(pytorch_linux_bionic_rocm)/,name:"ROCm"}],vision:[{regex:/ci\/circleci: unittest/,name:"CircleCI unittest"},{regex:/ci\/circleci: binary_linux/,name:"CircleCI binary_linux"},{regex:/ci\/circleci: binary_macos/,name:"CircleCI binary_macos"},{regex:/ci\/circleci: binary_win/,name:"CircleCI binary_win"}],audio:[{regex:/ci\/circleci: unittest/,name:"CircleCI unittest"},{regex:/ci\/circleci: binary_linux/,name:"CircleCI binary_linux"},{regex:/ci\/circleci: binary_macos/,name:"CircleCI binary_macos"},{regex:/ci\/circleci: binary_win/,name:"CircleCI binary_win"},{regex:/ci\/circleci: nightly_binary_linux/,name:"CircleCI nightly_binary_linux"},{regex:/ci\/circleci: nightly_binary_macos/,name:"CircleCI nightly_binary_macos"},{regex:/ci\/circleci: nightly_binary_win/,name:"CircleCI nightly_binary_win"}],text:[{regex:/ci\/circleci: unittest/,name:"CircleCI unittest"},{regex:/ci\/circleci: binary_linux/,name:"CircleCI binary_linux"},{regex:/ci\/circleci: binary_macos/,name:"CircleCI binary_macos"},{regex:/ci\/circleci: binary_win/,name:"CircleCI binary_win"},{regex:/ci\/circleci: nightly_binary_linux/,name:"CircleCI nightly_binary_linux"},{regex:/ci\/circleci: nightly_binary_macos/,name:"CircleCI nightly_binary_macos"},{regex:/ci\/circleci: nightly_binary_win/,name:"CircleCI nightly_binary_win"}],"pytorch-lightning":[{regex:/Nightly events/,name:"Nightly Events"},{regex:/Publish Docker Releases/,name:"Docker Releases"}]};var F=n(20),G=n(43),z=n(71);function H(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function J(e,t,n){for(;t<0;)t+=e.length;for(;n<0;)n+=e.length;if(n>=e.length)for(var r=n-e.length+1;r--;)e.push(void 0);e.splice(n,0,e.splice(t,1)[0])}function W(e){return"SUCCESS"===e||"success"===e}function Z(e){return"FAILURE"===e||"failure"===e||"error"===e||"timed_out"===e}function q(e){return"ABORTED"===e||"cancelled"===e}function $(e){return!e||"pending"===e}function V(e){return"skipped"===e}function K(e){return"infrastructure_fail"===e}function X(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=new Set,r=new Map;e.known_jobs.forEach((function(e){"pytorch_doc_push"!==e&&"__dr.ci"!==e&&(e.includes("nightlies")||n.add(e))}));for(var a=0;a<e.builds.length&&!(a>t)&&n.size;a++){var c=e.builds[a],s=c.sb_map;s.forEach((function(e,t){if(n.has(t))if(Z(e.status)){var a=r.get(t)||0;a++,r.set(t,a)}else W(e.status)&&n.delete(t);else;}))}return r.forEach((function(e,t){e<=1&&r.delete(t)})),r}function Q(e){var t=e.jobName;return/caffe2-builds/.test(e.url)?"jenkins: caffe2-"+t:"jenkins: "+t}var Y=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={jobNameFilter:e.defaultValue||"",onSubmit:e.onSubmit||function(e){}},r}return Object(d.a)(n,[{key:"render",value:function(){var e=this;return Object(x.jsxs)("form",{onSubmit:function(t){t.preventDefault(),e.state.onSubmit(e.state.jobNameFilter)},children:[Object(x.jsx)("label",{htmlFor:"job-name-filter",children:"Name filter:\xa0"}),Object(x.jsx)("input",{type:"input",name:"job-name-filter",id:"job-name-filter",value:this.state.jobNameFilter,onChange:function(t){e.setState({jobNameFilter:t.target.value})}}),Object(x.jsx)("input",{style:{marginLeft:"3px"},type:"submit",value:"Go"})]})}}]),n}(r.Component),ee=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state=r.initialState(),r}return Object(d.a)(n,[{key:"initialState",value:function(){var e=localStorage.getItem("prefs2"),t={};e&&(t=JSON.parse(e)),"showNotifications"in t||(t.showNotifications=!H()),"groupJobs"in t||(t.groupJobs=!0);var n=this.props.jobNameFilter||"";return{fetchedBuilds:!1,fetchError:!1,builds:[],lastUpdateDate:null,known_jobs:[],showGroups:[],currentTime:new Date,updateTime:new Date(0),showNotifications:t.showNotifications,groupJobs:0===n.length&&t.groupJobs,jobNameFilter:n}}},{key:"componentDidMount",value:function(){this.update(),this.interval=setInterval(this.update.bind(this),this.props.interval),!H()&&window.Notification&&this.state.showNotifications&&"granted"!==window.Notification.permission&&window.Notification.requestPermission()}},{key:"componentDidUpdate",value:function(e){localStorage.setItem("prefs2",JSON.stringify({showNotifications:this.state.showNotifications,groupJobs:this.state.groupJobs})),this.props.branch!==e.branch&&(this.setState(this.initialState()),this.update())}},{key:"addJenkinsResults",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.job("pytorch-".concat(this.props.branch),{tree:"builds[\n                url,\n                number,\n                duration,\n                timestamp,\n                result,\n                actions[parameters[name,value],\n                causes[shortDescription]],\n                changeSet[items[commitId,comment,msg]],\n                subBuilds[\n                  result,jobName,url,duration,\n                  build[\n                    subBuilds[\n                      result,jobName,url,duration,\n                      build[\n                        subBuilds[result,jobName,url,duration]\n                      ]\n                    ]\n                  ]\n                ]\n             ]".replace(/\s+/g,"")});case 2:n=e.sent,r=new Map,t.forEach((function(e,t){r[e.id]=t})),n&&n.builds.forEach((function(e){if(1===e.changeSet.items.length){var n=e.changeSet.items[0].commitId;if(n in r){var a=r[n];e.subBuilds.forEach((function e(n){n.build&&"com.tikal.jenkins.plugins.multijob.MultiJobBuild"===n.build._class?n.build.subBuilds.forEach(e):t[a].sb_map.set(Q(n),Object.fromEntries([["status",n.result],["build_url",j.link(n.url+"/console")]]))}))}}}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n,r,a,c,s,o,u,h,d,p,f,b,j,x,g,y,O,_=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Date,this.setState({currentTime:t}),n=this.props.branch,r=this.props.user,a=this.props.repo,(c=window.location.origin).includes("localhost")||(c+="/tvm-hud"),s=c+"/statuses/".concat(r,"/").concat(a,"/").concat(n.replace("/","_"),".json"),o=null,e.prev=9,e.next=12,m.a.get(s);case 12:o=e.sent,e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(9),this.setState({fetchError:!0}),e.abrupt("return");case 19:u=[],h=Object(N.a)(o.data);try{for(h.s();!(d=h.n()).done;){p=d.value,f=new Map,b=Object(N.a)(p.jobs);try{for(b.s();!(j=b.n()).done;)x=j.value,"neutral"===(g=x.status)&&(g="skipped"),"queued"===g&&(g="pending"),f.set(x.name,{build_url:x.url,status:g})}catch(l){b.e(l)}finally{b.f()}u.push({author:{username:p.author},message:p.headline+"\n"+p.body,sb_map:f,id:p.sha,timestamp:p.date,url:"https://github.com/".concat(this.props.user,"/").concat(this.props.repo,"/commit/").concat(p.sha)})}}catch(l){h.e(l)}finally{h.f()}if("pytorch"!==this.props.repo||"master"!==n){e.next=25;break}return e.next=25,this.addJenkinsResults(u);case 25:(y={}).updateTime=new Date,y.lastUpdateDate=new Date(o.headers["last-modified"]),y.fetchedBuilds=!0,y.connectedIn=y.updateTime-t,O=new Set,u.forEach((function(e){e.sb_map.forEach((function(e,t){O.add(t)}))})),y.known_jobs=Object(i.a)(O.values()).sort(),y.builds=u,"pytorch"===this.props.repo&&(y.consecutive_failure_count=X(y),H()||(this.state.consecutive_failure_count&&this.state.consecutive_failure_count.forEach((function(e,t){y.consecutive_failure_count.has(t)||new window.Notification("\u2705 "+_.props.job,{body:v(t)})})),y.consecutive_failure_count.forEach((function(e,t){_.state.consecutive_failure_count&&!_.state.consecutive_failure_count.has(t)&&new window.Notification("\u274c "+_.props.job,{body:v(t)})})))),this.setState(y);case 36:case"end":return e.stop()}}),e,this,[[9,15]])})));return function(){return e.apply(this,arguments)}}()},{key:"nameMatches",value:function(e,t){if(e.includes(t))return!0;try{var n=new RegExp(t);return Boolean(e.match(n))}catch(r){return!1}}},{key:"shouldShowJob",value:function(e){var t=this.state.jobNameFilter;if(t.length>0&&!this.nameMatches(e,t))return!1;var n=e.startsWith("ci/circleci: docker"),r=e.startsWith("ci/circleci: ecr_gc"),a=e.endsWith("ciflow_should_run"),c=e.endsWith("generate-test-matrix");return!(n||"welcome"===e||r||a||c)}},{key:"render",value:function(){var e,t=this,n=function(e){var t=[];if(!M[e])return console.error("Unknown group repo ".concat(e)),[];var n,r=Object(N.a)(M[e]);try{for(r.s();!(n=r.n()).done;){var a=n.value,c={};Object.assign(c,a),t.push(c)}}catch(s){r.e(s)}finally{r.f()}return t}(this.props.repo),a=Object(N.a)(n);try{for(a.s();!(e=a.n()).done;){e.value.jobNames=[]}}catch(ee){a.e(ee)}finally{a.f()}this.state.groupJobs||(n=[]);var c=function(e){var t,r=Object(N.a)(n);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(e.match(a.regex))return a}}catch(ee){r.e(ee)}finally{r.f()}return null},s=function(e){var n,r=Object(N.a)(t.state.showGroups);try{for(r.s();!(n=r.n()).done;){if(n.value.name===e.name)return!0}}catch(ee){r.e(ee)}finally{r.f()}return!1},i=function(e){var n,r=Object(N.a)(e.jobNames);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(t.state.consecutive_failure_count&&t.state.consecutive_failure_count.has(a))return!0}}catch(ee){r.e(ee)}finally{r.f()}return!1};function o(e){return W(e)?Object(x.jsx)("span",{role:"img",style:{color:"green"},"aria-label":"passed",children:"0"}):V(e)?Object(x.jsx)("span",{role:"img",style:{color:"gray"},"aria-label":"skipped",children:"S"}):Z(e)?Object(x.jsx)("span",{role:"img",style:{color:"red"},"aria-label":"failed",children:"X"}):q(e)?Object(x.jsx)("span",{role:"img",style:{marginLeft:"-2px",color:"gray"},"aria-label":"cancelled",children:Object(x.jsx)(z.a,{})}):$(e)?Object(x.jsx)("span",{className:"animate-flicker",role:"img",style:{color:"goldenrod"},"aria-label":"in progress",children:"?"}):K(e)?Object(x.jsx)("span",{role:"img",style:{color:"grey"},"aria-label":"failed",children:"X"}):e}var l,u=this.state.builds,h=this.state.consecutive_failure_count,d=this.state.known_jobs.filter((function(e){return t.shouldShowJob(e)})),p={},f=Object(N.a)(d);try{for(f.s();!(l=f.n()).done;){var b=l.value,m=c(b);!m||s(m)?m={name:b,jobNames:[b]}:m.jobNames.push(b),p[m.name]=m}}catch(ee){f.e(ee)}finally{f.f()}var j=[];for(var g in p)j.push({name:g,group:p[g]});var O,_=Object(N.a)(this.state.showGroups);try{for(_.s();!(O=_.n()).done;){var w=O.value;j.push({name:w.name,group:w})}}catch(ee){_.e(ee)}finally{_.f()}j.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}));var k,S=Object(N.a)(this.state.showGroups);try{var C=function(){var e=k.value,t=j.findIndex((function(t){return t.name===e.name}));if(null===t)return console.error("Unable to find group ".concat(e.name)),"continue";var n,r=Object(N.a)(e.jobNames);try{var a=function(){var r=n.value,a=j.findIndex((function(e){return e.name===r}));if(null===a)return console.error("Unable to job ".concat(r," in group ").concat(e.name)),"continue";J(j,a,a<t?t:t+1)};for(r.s();!(n=r.n()).done;)a()}catch(ee){r.e(ee)}finally{r.f()}};for(S.s();!(k=S.n()).done;)C()}catch(ee){S.e(ee)}finally{S.f()}for(var I=function(e){var n=t.state.showGroups;s(e)?n.pop(n.findIndex((function(t){return t.name===e.name}))):n.push(e),t.setState({showGroups:n})},L=[],E=0,D=j;E<D.length;E++){var A=D[E],T=A.name;1===A.group.jobNames.length&&(T=A.group.jobNames[0]);var U=Object(x.jsx)("th",{className:"rotate",children:Object(x.jsx)("div",{className:h&&h.has(T)?"failing-header":"",children:v(T)})},T);A.group.jobNames.length>1&&function(){var e=A.group,t=Object(x.jsx)(F.b,{});s(e)&&(t=Object(x.jsx)(F.a,{}));var n="";i(e)&&(n="failing-text"),U=Object(x.jsx)("th",{className:"rotate",children:Object(x.jsxs)("div",{onClick:function(){I(e)},onAuxClick:function(){I(e)},style:{cursor:"pointer"},children:[Object(x.jsx)("span",{style:{color:"#d0d0d0"},children:"Group "}),Object(x.jsx)("span",{className:n,children:e.name})," ",t]})},T)}(),L.push(U)}var P=function(e){var n=new RegExp("^https://github.com/"+t.props.user+"/"+t.props.repo+"/runs/\\d+$");return e.match(n)?e+"?check_suite_focus=true":e};u.forEach((function(e){e.sb_map.forEach((function(e){e.status&&(e.status=e.status.toLowerCase())}))}));var B=u.map((function(e){var n=e.sb_map,a=j.map((function(e){var t=Object(x.jsx)(r.Fragment,{}),a=e.name;if(e.group.jobNames.length>1){a="Group: ".concat(e.group.name);var c=function(e){if(0===(e=e.filter((function(e){return void 0!==e}))).length)return null;var t,n=Object(N.a)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(Z(r.status)||K(r.status))return"failure"}}catch(ee){n.e(ee)}finally{n.f()}var a,c=Object(N.a)(e);try{for(c.s();!(a=c.n()).done;)if($(a.value.status))return"pending"}catch(ee){c.e(ee)}finally{c.f()}var s,i=!0,o=Object(N.a)(e);try{for(o.s();!(s=o.n()).done;){var l=s.value;W(l.status)||V(l.status)||q(l.status)||(i=!1)}}catch(ee){o.e(ee)}finally{o.f()}return i?"success":"pending"}(e.group.jobNames.map((function(e){return n.get(e)})));c&&(t=Object(x.jsx)("div",{className:"display-cell",style:{fontWeight:"bold"},onClick:function(){I(e.group)},onAuxClick:function(){I(e.group)},children:o(c)}))}else{1===e.group.jobNames.length&&(a=e.group.jobNames[0]);var s=n.get(a);void 0!==s&&(t=Object(x.jsx)("div",{className:"display-cell",children:Object(x.jsx)("a",{href:P(s.build_url),className:"icon",target:"_blank",alt:a,rel:"noreferrer",children:o(s.status)})}))}return Object(x.jsx)(R.a,{overlay:a,mouseLeaveDelay:0,placement:"rightTop",destroyTooltipOnHide:{keepParent:!1},children:Object(x.jsx)("td",{className:"icon-cell",children:t},a)},a)}));var c,s=e.author.username,i=Object(x.jsxs)("div",{children:[Object(x.jsxs)("a",{style:{color:"#003d7f"},href:"/commit/".concat(t.props.user,"/").concat(t.props.repo,"/").concat(e.id),children:[(c=e.message,c.replace(/\(#[0-9]+\)/,"")).split("\n")[0]," "]}),Object(x.jsx)("code",{children:Object(x.jsx)("a",{href:"https://github.com/".concat(t.props.user,"/").concat(t.props.repo,"/commit/").concat(e.id),target:"_blank",rel:"noreferrer",children:e.id.slice(0,7)})})]},e.id),l=y(e.timestamp);return Object(x.jsxs)("tr",{className:"",children:[Object(x.jsx)("td",{className:"left-cell",title:e.timestamp,children:l}),a,Object(x.jsx)("td",{className:"right-cell",style:{maxWidth:"6em",textOverflow:"ellipsis",overflow:"hidden"},children:s}),Object(x.jsx)("th",{className:"right-cell",style:{paddingLeft:"0",paddingRight:"5px"},children:function(e){var n=e.match(/\(#(\d+)\)/);return n||(n=e.match(/https:\/\/github.com\/pytorch\/pytorch\/pull\/(\d+)/))?Object(x.jsx)(r.Fragment,{children:Object(x.jsxs)("a",{href:"https://github.com/".concat(t.props.user,"/").concat(t.props.repo,"/pull/").concat(n[1]),target:"_blank",rel:"noreferrer",children:["#",n[1]]})}):Object(x.jsx)(r.Fragment,{})}(e.message)}),Object(x.jsx)("td",{children:i})]},e.id)})),X=null;this.state.fetchError?X=Object(x.jsxs)("p",{children:["Error fetching commits, either the branch does not exist or is not tracked by the"," ",Object(x.jsx)("a",{href:"https://github.com/pytorch/test-infra/tree/main/aws/lambda/github-status-sync",children:"status syncing job"})]}):this.state.fetchedBuilds&&0===B.length?X=Object(x.jsx)("p",{children:"Fetched data but found no rows"}):this.state.fetchedBuilds||(X=Object(x.jsx)("div",{style:{margin:"10px"},children:Object(x.jsx)(G.a,{className:"icon-spin"})}));var Q=null;return this.state.lastUpdateDate&&(Q=Object(x.jsxs)("p",{style:{fontSize:"0.8em"},children:["Last updated ",this.state.lastUpdateDate.toLocaleString()," "]})),Object(x.jsxs)("div",{children:[Object(x.jsxs)("h4",{children:[Object(x.jsxs)("a",{href:"https://github.com/".concat(this.props.user,"/").concat(this.props.repo,"/commits/").concat(this.props.branch),children:[this.props.user,"/",this.props.repo,"/",this.props.branch]})," ","CI history"," "]}),Q,Object(x.jsx)("div",{children:Object(x.jsxs)("ul",{className:"menu",children:[H()?null:Object(x.jsxs)("li",{children:[Object(x.jsx)("input",{type:"checkbox",name:"show-notifications",checked:this.state.showNotifications,onChange:function(e){return t.setState({showNotifications:e.target.checked})}}),Object(x.jsxs)("label",{htmlFor:"show-notifications",children:["Show notifications on master failure",this.state.showNotifications&&window.Notification&&"denied"===window.Notification.permission?Object(x.jsxs)(r.Fragment,{children:[" ",Object(x.jsx)("strong",{children:"(WARNING: notifications are currently denied)"})]}):""]})]}),H()?null:Object(x.jsx)("br",{}),Object(x.jsxs)("li",{children:[Object(x.jsx)("input",{type:"checkbox",name:"group-jobs",checked:this.state.groupJobs,onChange:function(e){return t.setState({groupJobs:e.target.checked})}}),Object(x.jsx)("label",{htmlFor:"group-jobs",children:"Group related jobs"})]}),Object(x.jsx)("li",{children:Object(x.jsx)(Y,{onSubmit:function(e){t.setState({jobNameFilter:e})},defaultValue:this.props.jobNameFilter})})]})}),B.length>0?Object(x.jsxs)("table",{className:"buildHistoryTable",children:[Object(x.jsx)("thead",{children:Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{className:"left-cell",children:"Date"}),L,Object(x.jsx)("th",{className:"right-cell",children:"User"}),Object(x.jsx)("th",{className:"right-cell",children:"PR#"}),Object(x.jsx)("th",{className:"right-cell",children:"Description"})]})}),Object(x.jsx)("tbody",{children:B})]}):null,X]})}}]),n}(r.Component),te=n(10),ne=n(17),re=n(44),ae=n(47),ce=n(72),se=n(54),ie=n(21),oe=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){return Object(x.jsxs)("div",{style:{display:"inline-block"},children:[Object(x.jsx)(G.a,{style:{fontSize:"1em",marginRight:"5px"},className:"icon-spin"}),Object(x.jsx)("span",{children:this.props.text})]})}}]),n}(r.Component);function le(e){if(!e)return"-";if(e<1024)return e+"  B";var t=1e6;if(e<t)return(e/1024).toFixed(0)+" KB";var n=1e9;return e<n?(e/t).toFixed(2)+" MB":(e/n).toFixed(2)+" GB"}function ue(e,t){var n=null;if(!window.DOMParser)throw new Error("cannot parse xml string!");function r(e,n){if("#text"!==e.nodeName){var a={},c=n[e.nodeName];if(c?Array.isArray(c)?n[e.nodeName].push(a):n[e.nodeName]=[c,a]:t&&-1!==t.indexOf(e.nodeName)?n[e.nodeName]=[a]:n[e.nodeName]=a,e.attributes){var s,i=Object(N.a)(e.attributes);try{for(i.s();!(s=i.n()).done;){var o=s.value;a[o.nodeName]=o.nodeValue}}catch(d){i.e(d)}finally{i.f()}}a.textContent=e.textContent;var l,u=Object(N.a)(e.childNodes);try{for(u.s();!(l=u.n()).done;){r(l.value,a)}}catch(d){u.e(d)}finally{u.f()}}else{var h=e.nodeValue;h.trim()&&(n["#text"]=h)}}n=(new DOMParser).parseFromString(e,"text/xml");var a,c={},s=Object(N.a)(n.childNodes);try{for(s.s();!(a=s.n()).done;){r(a.value,c)}}catch(i){s.e(i)}finally{s.f()}return c}function he(e){return de.apply(this,arguments)}function de(){return(de=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map((function(e){return e()})),e.next=3,Promise.all(n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pe(e){return fe.apply(this,arguments)}function fe(){return(fe=Object(u.a)(l.a.mark((function e(t){var n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=localStorage.getItem("gh_pat"),e.next=3,fetch("https://api.github.com/graphql",{method:"POST",headers:{Authorization:"token "+n},body:JSON.stringify({query:t})});case 3:if(200===(r=e.sent).status){e.next=12;break}return e.t0=Error,e.t1="Error fetching data from GitHub: ",e.next=9,r.text();case 9:throw e.t2=e.sent,e.t3=e.t1.concat.call(e.t1,e.t2),new e.t0(e.t3);case 12:return e.next=14,r.json();case 14:if(!(a=e.sent).errors){e.next=17;break}throw new Error("Error in GraphQL response: ".concat(JSON.stringify(a.errors)));case 17:return e.abrupt("return",a);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function be(){return(be=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe(t);case 2:return e.abrupt("return",e.sent.data);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(){return(me=Object(u.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=localStorage.getItem("gh_pat"),e.next=3,fetch("https://api.github.com/"+t,{headers:{Accept:"application/vnd.github.v3+json",Authorization:"token "+n}});case 3:return r=e.sent,e.next=6,r.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function je(){return(je=Object(u.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=localStorage.getItem("gh_pat"),e.next=3,fetch("https://api.github.com/"+t,{headers:{Accept:"application/vnd.github.v3+json",Authorization:"token "+n}});case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var xe={graphql:function(e){return be.apply(this,arguments)},graphql_raw:pe,json:function(e){return me.apply(this,arguments)},raw:function(e){return je.apply(this,arguments)}};function ge(e,t){var n=new URLSearchParams(window.location.search);n.set(e,t),window.history.pushState("","",window.location.pathname+"?"+n.toString())}function ve(e,t){return ye.apply(this,arguments)}function ye(){return(ye=Object(u.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://".concat(n,".s3.amazonaws.com/?")+new URLSearchParams({"list-type":2,delimiter:"/",prefix:t,"max-keys":50})).then((function(e){return e.text()})).then((function(e){return ue(e)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Oe=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).highlight=function(){r.nodeRef&&Object(ce.highlightElement)(r.nodeRef.current.children[0],{language:"python"})},r.nodeRef=a.a.createRef(),r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.highlight()}},{key:"render",value:function(){var e=this.props.testcase,t=e.failure||e.error,n=(Array.isArray(t)?t:[t]).map((function(e){return e.textContent.trim()})).join("\n\n"),r=null;return e.file&&e.line&&(r=Object(x.jsxs)("span",{style:{color:"grey"},children:[e.file,":",e.line,":"]})),Object(x.jsx)(ne.a,{style:{fontFamily:'"Monaco", monospace',marginTop:"5px",backgroundColor:"#ffe5e5"},children:Object(x.jsx)(ne.a.Body,{children:Object(x.jsxs)("div",{children:[Object(x.jsxs)("p",{children:[r,e.classname,".",e.name]}),Object(x.jsx)("pre",{ref:this.nodeRef,children:Object(x.jsx)("code",{className:"language-python",children:n})})]})})})}}]),n}(r.Component),_e=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={showDetail:!1},r}return Object(d.a)(n,[{key:"render",value:function(){for(var e=this,t=null,n=[],r=0,a=Object.entries(this.props.info);r<a.length;r++)for(var c=Object(te.a)(a[r],2),s=c[0],i=c[1],o=0,l=Object.entries(i);o<l.length;o++){var u=Object(te.a)(l[o],2),h=u[0],d=u[1];d.filename=s,d.classname=h,n.push(d)}n=n.sort((function(e,t){return e=e.passed+e.error,(t=t.passed+t.error)-e}));var p,f={passed:0,error:0,skipped:0},b=Object(N.a)(n);try{for(b.s();!(p=b.n()).done;){var m=p.value;f.passed+=m.passed,f.error+=m.error,f.skipped+=m.skipped}}catch(w){b.e(w)}finally{b.f()}if(this.state.showDetail){var j,g=[],v=Object(N.a)(n);try{for(v.s();!(j=v.n()).done;){var y=j.value,O=y.filename.split("/").slice(-1)[0],_="".concat(O,":").concat(y.classname);g.push(Object(x.jsxs)("tr",{style:{fontSize:"12px",backgroundColor:y.error>0?"#ffe4e4":"white"},children:[Object(x.jsxs)("td",{style:{fontFamily:'"Monaco", monospace'},children:[Object(x.jsxs)("span",{style:{color:"grey"},children:[O,":"]}),Object(x.jsx)("span",{children:y.classname})]}),Object(x.jsx)("td",{className:"center",children:y.passed}),Object(x.jsx)("td",{className:"center",children:y.error}),Object(x.jsx)("td",{className:"center",children:y.skipped})]},_))}}catch(w){v.e(w)}finally{v.f()}t=Object(x.jsxs)("table",{style:{marginTop:"6px"},className:"table",children:[Object(x.jsx)("thead",{children:Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{className:"center",children:"Name"}),Object(x.jsx)("th",{className:"center",children:"Passed"}),Object(x.jsx)("th",{className:"center",children:"Errors"}),Object(x.jsx)("th",{className:"center",children:"Skipped"})]})}),Object(x.jsx)("tbody",{children:g})]})}return Object(x.jsx)(ne.a,{style:{marginTop:"5px"},children:Object(x.jsxs)(ne.a.Body,{children:[Object(x.jsx)(ne.a.Title,{style:{marginBottom:0},children:"Test Summary"}),Object(x.jsxs)("div",{children:[Object(x.jsxs)("p",{style:{marginBottom:0},children:["Ran ",this.props.totals.cases," test cases in"," ",this.props.totals.classes," classes from ",this.props.totals.files," ","files"]}),Object(x.jsxs)("p",{style:{marginBottom:0},children:[f.passed," tests passed, ",f.error," tests failed,"," ",f.skipped," tests skipped",Object(x.jsxs)("button",{style:{marginLeft:"10px",fontSize:"0.8em"},className:"btn btn-secondary",onClick:function(){var t=e.state.showDetail;e.setState({showDetail:!t})},children:[this.state.showDetail?"Hide":"Show"," Details"]})]}),t]})]})})}}]),n}(r.Component),we=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={},r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.update().catch((function(t){console.error(t),e.setState({updateFailure:t.toString()})}))}},{key:"update",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n,r,a,c,s,i,o,u,h,d,p,f,b,m,j,x,g,v,y,O,_,w,k,S,C,I,L;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.props.testReportZip).then((function(e){return e.arrayBuffer()}));case 2:for(c in t=e.sent,n={},r=new Uint8Array(t),a=Object(se.b)(r))s=c.replace("test/test-reports/","").replace(".xml",""),n[s]=ue(Object(se.a)(a[c]));for(o in i=[],n)if((u=n[o]).testsuite)i.push(u.testsuite);else if(u.testsuites)if(Array.isArray(u.testsuites.testsuite)){h=Object(N.a)(u.testsuites.testsuite);try{for(h.s();!(d=h.n()).done;)p=d.value,i.push(p)}catch(l){h.e(l)}finally{h.f()}}else u.testsuites.testsuite&&i.push(u.testsuites.testsuite);else console.error("Unknown report type",u);for(f=[],b={},m={classes:0,cases:0,files:0,time:0},j=0,x=i;j<x.length;j++){if(g=x[j],v=+g.errors,y=+g.failures,O=g.testcase,Array.isArray(O)||(O=[O]),v+y>0){_=Object(N.a)(O);try{for(_.s();!(w=_.n()).done;)((k=w.value).failure||k.error)&&f.push(k)}catch(l){_.e(l)}finally{_.f()}}S=function(e){return e.skipped?"skipped":e.error||e.failure?"error":"passed"},C=Object(N.a)(O);try{for(C.s();!(I=C.n()).done;)L=I.value,m.cases+=1,b[L.file]||(b[L.file]={},m.files+=1),b[L.file][L.classname]||(m.classes+=1,b[L.file][L.classname]={passed:0,error:0,skipped:0,time:0,cases:0}),m.time+=+L.time,b[L.file][L.classname][S(L)]+=1,b[L.file][L.classname].cases+=1,b[L.file][L.classname].time+=+L.time}catch(l){C.e(l)}finally{C.f()}}this.props.onLoaded&&this.props.onLoaded(f,m,b),this.setState({failures:f,totals:m,testInfo:b});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderSummary",value:function(){}},{key:"render",value:function(){if(!this.state.failures)return this.state.updateFailure?Object(x.jsxs)("p",{style:{color:"red"},children:["Loading/parsing failed: ",this.state.updateFailure]}):Object(x.jsx)(oe,{text:"Loading test results"});var e=[],t=Object(x.jsx)(_e,{info:this.state.testInfo,totals:this.state.totals});if(0===this.state.failures.length)return Object(x.jsxs)("div",{children:[this.props.noSummary?null:t,Object(x.jsx)(ne.a,{style:{marginTop:"5px",backgroundColor:"#ebffeb"},children:Object(x.jsx)(ne.a.Body,{children:Object(x.jsxs)(ne.a.Title,{style:{marginBottom:0},children:[Object(x.jsx)(ie.a,{style:{color:"#22863a"}})," ",Object(x.jsx)("span",{children:"All tests passed"})]})})})]});var n,r=0,a=Object(N.a)(this.state.failures);try{for(a.s();!(n=a.n()).done;){var c=n.value;e.push(Object(x.jsx)(Oe,{testcase:c},r++))}}catch(s){a.e(s)}finally{a.f()}return Object(x.jsxs)("div",{children:[this.props.noSummary?null:t,e]})}}]),n}(r.Component),ke=n(33);function Se(e){var t,n=[/Z Entering 'third_party/,/Z http\.https:\/\/github\.com\/\.extraheader/,/Z deleted: sha256/,/Z untagged: sha256/,/Z untagged: .*amazonaws/,/Z \s*adding: /,/Z \s*creating: /,/Z \s*inflating: /,/Z \s*extracting: /,/Z adding /,/Z copying /,/Z creating /,/Z refs\/remotes\/origin/,/Z Synchronizing submodule url for/,/Z Receiving objects:/,/Z Resolving deltas:/,/Z remote: Compressing objects:/,/Z Submodule path /,/Z remote: Counting objects:/,/Z [a-z0-9]{12}: Waiting/,/Z [a-z0-9]{12}: Pulling fs layer/,/Z [a-z0-9]{12}: Verifying Checksum/,/Z [a-z0-9]{12}: Download complete/,/Z [a-z0-9]{12}: Pull complete/,/Z url\.https:\/\/github\.com/,/Z Generating XML reports/,/Z Generated XML report/,/Z Test results will be stored/],r=e.split("\n"),a="",c=Object(N.a)(r);try{for(c.s();!(t=c.n()).done;){var s,i=t.value,o=!0,l=Object(N.a)(n);try{for(l.s();!(s=l.n()).done;){var u=s.value;if(i.match(u)){o=!1;break}}}catch(h){l.e(h)}finally{l.f()}o&&(a+=i+"\n")}}catch(h){c.e(h)}finally{c.f()}return a}function Ce(e,t){e.languages.register({id:"logText"}),e.languages.setMonarchTokensProvider("logText",{tokenizer:{root:[[/\[30;1m.*?\[0m/,"black"],[/\[31;1m.*?\[0m/,"red"],[/\[32;1m.*?\[0m/,"green"],[/\[33;1m.*?\[0m/,"yellow"],[/\[34;1m.*?\[0m/,"blue"],[/\[35;1m.*?\[0m/,"magenta"],[/\[36;1m.*?\[0m/,"cyan"],[/\[37;1m.*?\[0m/,"white"],[/\[30m.*?\[0m/,"black"],[/\[31m.*?\[0m/,"red"],[/\[32m.*?\[0m/,"green"],[/\[33m.*?\[0m/,"yellow"],[/\[34m.*?\[0m/,"blue"],[/\[35m.*?\[0m/,"magenta"],[/\[36m.*?\[0m/,"cyan"],[/\[37m.*?\[0m/,"white"],[/\[0;1;30m.*?\[0m/,"black"],[/\[0;1;31m.*?\[0m/,"red"],[/\[0;1;32m.*?\[0m/,"green"],[/\[0;1;33m.*?\[0m/,"yellow"],[/\[0;1;34m.*?\[0m/,"blue"],[/\[0;1;35m.*?\[0m/,"magenta"],[/\[0;1;36m.*?\[0m/,"cyan"],[/\[0;1;37m.*?\[0m/,"white"],[/\[1m.*?\[0m/,"cyan"],[/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{7}Z/,"hidden"]]}}),e.editor.defineTheme("logTheme",{base:"vs-dark",inherit:!0,rules:[{token:"black",foreground:"000000",fontStyle:"bold"},{token:"red",foreground:"af0000",fontStyle:"bold"},{token:"green",foreground:"87d700",fontStyle:"bold"},{token:"yellow",foreground:"d7d700",fontStyle:"bold"},{token:"blue",foreground:"5fd7ff",fontStyle:"bold"},{token:"magenta",foreground:"8700af",fontStyle:"bold"},{token:"cyan",foreground:"00af87",fontStyle:"bold"},{token:"white",foreground:"ffffff",fontStyle:"bold"},{token:"hidden",foreground:"5f5f5f"}]}),e.languages.registerFoldingRangeProvider("logText",{provideFoldingRanges:function(e,n,r){return t}})}function Ne(e){return Object(x.jsx)(R.a,{overlay:e,mouseLeaveDelay:0,placement:"rightTop",destroyTooltipOnHide:{keepParent:!1},children:Object(x.jsx)("span",{style:{fontSize:"16px",color:"#a1a1a1",cursor:"pointer"},children:Object(x.jsx)(F.c,{})})},"help")}var Ie=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={},r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.update()}},{key:"update",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xe.raw(this.props.url);case 2:return t=e.sent,e.next=5,t.text();case 5:n=e.sent,this.props.transform&&(n=this.this.props.transform(n)),r=(n.match(/\n/g)||"").length+1,this.setState({text:n,totalLines:r});case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;if(!this.state.text)return Object(x.jsx)(oe,{text:"Downloading logs"});return Object(x.jsx)(ke.a,{height:"".concat(15,"em"),defaultLanguage:"logText",defaultValue:this.state.text,theme:"logTheme",beforeMount:function(e){Ce(e,[])},options:{scrollBeyondLastLine:!1,lineNumbersMinChars:this.state.totalLines.toString().length+1,folding:!0},onMount:function(t,n){t.getAction("editor.foldAll").run().then((function(){var n=parseInt(function(e,t){var n=Array.from(e.matchAll(/(?<!if-no-files-found: )error/g)).slice(-1)[0].index;return function(e,t){return(e.substring(0,t).match(/\n/g)||"").length}(e,n)}(e.state.text,e.state.totalLines)+7.5);t.revealLine(n)}))},loading:Object(x.jsx)(oe,{text:"Loading viewer"})})}}]),n}(r.Component),Le=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={},r.state.shown=!0,r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.update()}},{key:"update",value:function(){var e=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e,t=this,n=[],r=Object(N.a)(this.props.failures);try{for(r.s();!(e=r.n()).done;){var a=e.value,c=[];if(void 0===a.data.state){c=a.data.checkRuns.nodes.filter((function(e){return"FAILURE"===e.conclusion}));var s,i=a.data.workflowRun.workflow.name,o=null,l=Object(N.a)(c);try{var u=function(){var e=s.value;o=e.name.startsWith("test (")&&!e.incorrectReport?e.artifactUrl?Object(x.jsx)(we,{testReportZip:e.artifactUrl,noSummary:!0,onLoaded:function(n,r,a){0===n.length&&(e.incorrectReport=!0,t.setState(t.state))}}):Object(x.jsx)("div",{children:Object(x.jsx)(oe,{text:"Loading test report"})}):Object(x.jsx)(Ie,{url:"repos/".concat(t.props.user,"/").concat(t.props.repo,"/actions/jobs/").concat(e.databaseId,"/logs")}),n.push(Object(x.jsxs)("div",{style:{marginBottom:"10px"},children:[Object(x.jsxs)("span",{style:{fontWeight:"bold"},children:[i," / ",e.name," ",e.incorrectReport?Ne("The XML test report for this job had no failures, but the job failed. This usually means something went wrong outside of a Python unittest."):null]}),o]},"fr-".concat(i,"-").concat(e.name)))};for(l.s();!(s=l.n()).done;)u()}catch(p){l.e(p)}finally{l.f()}}}}catch(p){r.e(p)}finally{r.f()}var h=function(){t.setState({shown:!t.state.shown})},d=Object(x.jsx)(F.b,{style:{cursor:"pointer"},onClick:h});return this.state.shown&&(d=Object(x.jsx)(F.a,{style:{cursor:"pointer"},onClick:h})),0===n.length?null:Object(x.jsx)(ne.a,{style:{marginBottom:"15px",boxShadow:"rgb(255 113 113) 0px 0px 9px -3px",border:"1px solid #ff6060"},children:Object(x.jsxs)(ne.a.Body,{children:[Object(x.jsxs)(ne.a.Title,{children:["GHA Failure Report"," ",Ne("Aggregated information from all failed jobs")," ",d]}),this.state.shown?n:null]})})}}]),n}(r.Component),Ee=n(80),Re=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;Object(h.a)(this,n),r=t.call(this,e);var a=e.status.targetUrl.match(/pytorch\/pytorch\/(\d+)/);if(r.state={showSteps:{}},a){var c=a[1];r.state.url="https://circleci.com/api/v1.1/project/gh/pytorch/pytorch/".concat(c)}return r}return Object(d.a)(n,[{key:"hasError",value:function(){return void 0!==this.state.errorMessage}},{key:"componentDidUpdate",value:function(){var e=Object(u.a)(l.a.mark((function e(t,n){var r,a,c,s=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasError()){e.next=2;break}return e.abrupt("return");case 2:if(this.state.data){e.next=4;break}return e.abrupt("return");case 4:r=Object(N.a)(this.state.data.steps),e.prev=5,c=function(){var e=a.value;if(!e.log.shown||void 0!==e.log.text)return"continue";fetch(e.actions[0].output_url).then((function(e){return e.text()})).then((function(t){e.log.text=t.replaceAll("\\n","\n").replaceAll("\\r",""),s.setState(s.state)}))},r.s();case 8:if((a=r.n()).done){e.next=14;break}if("continue"!==c()){e.next=12;break}return e.abrupt("continue",12);case 12:e.next=8;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(5),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[5,16,19,22]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.update()}},{key:"update",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.state.url);case 2:return t=e.sent,e.next=5,t.json();case 5:delete(n=e.sent).circle_yml,r=Object(N.a)(n.steps);try{for(r.s();!(a=r.n()).done;)a.value.log={text:void 0,shown:!1,logLevel:"Minimal"}}catch(c){r.e(c)}finally{r.f()}this.setState({data:n});case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderStatusIcon",value:function(e){return e=e.toUpperCase(),{SUCCESS:Object(x.jsx)(ie.a,{style:{color:"#22863a"}}),FAILURE:Object(x.jsx)(ie.d,{style:{color:"#cb2431"}}),FAILED:Object(x.jsx)(ie.d,{style:{color:"#cb2431"}}),TIMEDOUT:Object(x.jsx)(ie.d,{style:{color:"#cb2431"}}),NEUTRAL:Object(x.jsx)(ie.b,{style:{color:"#959da5"}}),CANCELLED:Object(x.jsx)(ie.b,{style:{color:"rgb(255 86 86)"}})}[e]||Object(x.jsx)(ie.c,{style:{color:"#dbab09"}})}},{key:"renderLogViewer",value:function(e){var t=this,n=null;if(e.log.shown)if(e.log.text){var r=null,a=((r="All"===e.log.logLevel?e.log.text:Se(e.log.text)).match(/\n/g)||"").length+1;e.log.existingEditor&&(e.log.existingEditor.setValue(r),e.log.existingEditor.revealLine(a)),n=Object(x.jsxs)("div",{style:{marginBottom:"20px"},children:[Object(x.jsxs)("div",{className:"hideRadio",children:[Object(x.jsx)("span",{children:"Log Level: "}),Object(x.jsx)("div",{style:{display:"inline"},children:Object(x.jsx)(re.a,{children:["Minimal","All"].map((function(n,r){return Object(x.jsx)(ae.a,{id:"radio-".concat(r),type:"radio",variant:"outline-info",name:"radio",value:n,checked:e.log.logLevel===n,onChange:function(r){e.log.logLevel=n,t.setState(t.state)},children:n},r)}))})})]}),Object(x.jsx)(ke.a,{height:"80vh",defaultLanguage:"logText",defaultValue:r,theme:"logTheme",beforeMount:function(e){Ce(e,[])},options:{scrollBeyondLastLine:!1,lineNumbersMinChars:a.toString().length+1,folding:!0},onMount:function(t,n){e.log.existingEditor=t,t.getAction("editor.foldAll").run().then((function(){t.revealLine(a)}))},loading:Object(x.jsx)("p",{children:"Loading viewer..."})})]})}else n=Object(x.jsx)("p",{children:"Fetching logs..."});return n}},{key:"render",value:function(){var e=this,t=this.props.status,n=null;if(this.state.data){var r,a=[],c=Object(N.a)(this.state.data.steps.entries());try{var s=function(){var n=Object(te.a)(r.value,2),c=n[0],s=n[1],i=s.name,o=e.renderStatusIcon(s.actions[0].status),l={cursor:"pointer"},u=function(){s.log.shown=!s.log.shown,e.setState(e.state)},h=Object(x.jsx)(F.b,{style:l,onClick:u});s.log.shown&&(h=Object(x.jsx)(F.a,{style:l,onClick:u})),a.push(Object(x.jsxs)("div",{style:{marginBottom:"2px"},children:[o," ",Object(x.jsx)("span",{children:i})," ",h," ",e.renderLogViewer(s)]},"status-".concat(t.context,"-").concat(i,"-").concat(c)))};for(c.s();!(r=c.n()).done;)s()}catch(i){c.e(i)}finally{c.f()}n=Object(x.jsx)("div",{style:{padding:"6px"},children:a})}return Object(x.jsx)(ne.a,{children:Object(x.jsxs)(ne.a.Body,{style:{backgroundColor:"FAILURE"===t.state?"rgb(255 243 243)":null},children:[Object(x.jsx)(ne.a.Title,{children:Object(x.jsx)("a",{href:t.targetUrl,children:t.context})}),Object(x.jsxs)("div",{children:[n,null]})]})},"card-"+t.context)}}]),n}(r.Component),De="https://docs-preview.pytorch.org";function Ae(e,t,n){return'\n    {\n      repository(name: "'.concat(t,'", owner: "').concat(e,'") {\n        pullRequest(number: ').concat(n,") {\n          commits(last: 100) {\n            nodes {\n              commit {\n                oid\n                messageHeadline\n              }\n            }\n          }\n        }\n      }\n    }\n  ")}function Te(e,t,n){return'\n    {\n      repository(name: "'.concat(t,'", owner: "').concat(e,'") {\n        object(oid:"').concat(n,'") {\n          ... on Commit {\n            history(first: 1) {\n              nodes {\n                oid\n                commitUrl\n                messageHeadline\n                messageBody\n                status {\n                  contexts {\n                    description\n                    context\n                    targetUrl\n                    state\n                  }\n                }\n                checkSuites(last: 100) {\n                  nodes {\n                    databaseId\n                    workflowRun {\n                      runNumber\n                      id\n                      databaseId\n                      workflow {\n                        name\n                        databaseId\n                      }\n                      url\n                    }\n                    checkRuns(last: 100) {\n                      nodes {\n                        name\n                        title\n                        status\n                        conclusion\n                        text\n                        databaseId\n                        detailsUrl\n                        summary\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  ')}var Ue=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={showGroups:[]},r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var e,t=this;this.update({selectedCommit:(e="prCommit",new URLSearchParams(window.location.search).get(e))}).catch((function(e){console.error(e),t.setState({error_message:e.toString()})}))}},{key:"isPr",value:function(){return void 0!==this.props.pr_number}},{key:"hasError",value:function(){return void 0!==this.state.error_message}},{key:"extractItem",value:function(e,t){return e[t]?Array.isArray(e[t])?e[t]:[e[t]]:null}},{key:"componentDidUpdate",value:function(){var e=Object(u.a)(l.a.mark((function e(t,n){var r,a,c,s,i,o,u=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasError()){e.next=2;break}return e.abrupt("return");case 2:r=Object(N.a)(this.state.runs),e.prev=3,r.s();case 5:if((a=r.n()).done){e.next=27;break}c=a.value,s=Object(N.a)(c.checkRuns.nodes),e.prev=8,o=function(){var e=i.value;if(!e.log.shown||null!==e.log.text)return"continue";xe.raw("repos/".concat(u.props.user,"/").concat(u.props.repo,"/actions/jobs/").concat(e.databaseId,"/logs")).then((function(e){return e.text()})).then((function(t){e.log.text=t,u.setState(u.state)}))},s.s();case 11:if((i=s.n()).done){e.next=17;break}if("continue"!==o()){e.next=15;break}return e.abrupt("continue",15);case 15:e.next=11;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(8),s.e(e.t0);case 22:return e.prev=22,s.f(),e.finish(22);case 25:e.next=5;break;case 27:e.next=32;break;case 29:e.prev=29,e.t1=e.catch(3),r.e(e.t1);case 32:return e.prev=32,r.f(),e.finish(32);case 35:case"end":return e.stop()}}),e,this,[[3,29,32,35],[8,19,22,25]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n,r,a,c,s,i,o,h,d,p,f,b,m,j,x,g,v=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(localStorage.setItem("last_redirect",window.location.href),(window.location.href.startsWith("http://localhost")||window.location.href.startsWith("https://deploy-preview"))&&(localStorage.getItem("gh_pat")||(n=prompt('In development mode, GitHub API token not found. You can get it from hud.pytorch.org by running localStorage.getItem("gh_pat") in the JavaScript console.'))&&localStorage.setItem("gh_pat",n)),!this.hasError()){e.next=4;break}return e.abrupt("return");case 4:if(localStorage.getItem("gh_pat")){e.next=7;break}return this.setState({error_message:"GitHub token no found, please log in"}),e.abrupt("return");case 7:if(r=void 0,a=void 0,!this.isPr()){e.next=32;break}if(c=null,!t||!t.selectedCommit){e.next=16;break}return s=t.selectedCommit,e.next=15,xe.graphql(Te(this.props.user,this.props.repo,s));case 15:c=e.sent;case 16:return e.next=18,Promise.all([xe.graphql((y=this.props.user,O=this.props.repo,_=this.props.pr_number,'\n    {\n      repository(name: "'.concat(O,'", owner: "').concat(y,'") {\n        pullRequest(number: ').concat(_,") {\n          title\n          number\n          url\n          body\n          comments(last: 10) {\n            nodes {\n              author {\n                login\n              }\n              body\n            }\n          }\n          commits(last: 1) {\n            nodes {\n              commit {\n                messageHeadline\n                oid\n                status {\n                  contexts {\n                    description\n                    context\n                    targetUrl\n                    state\n                  }\n                }\n                checkSuites(last: 100) {\n                  nodes {\n                    databaseId\n                    workflowRun {\n                      runNumber\n                      id\n                      databaseId\n                      workflow {\n                        name\n                        databaseId\n                      }\n                      url\n                    }\n                    checkRuns(last: 100) {\n                      nodes {\n                        name\n                        title\n                        status\n                        conclusion\n                        text\n                        databaseId\n                        detailsUrl\n                        summary\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  "))),xe.graphql(Ae(this.props.user,this.props.repo,this.props.pr_number))]);case 18:if(i=e.sent,o=Object(te.a)(i,2),h=o[0],d=o[1],(r=h.repository.pullRequest).allCommits=d.repository.pullRequest.commits.nodes.map((function(e){return[e.commit.oid,e.commit.messageHeadline]})).reverse(),null!==r&&void 0!==r){e.next=28;break}return this.state.error_message="Failed to fetch PR "+this.props.pr_number,this.setState(this.state),e.abrupt("return");case 28:c&&(r.commits.nodes=[{commit:c.repository.object.history.nodes[0]}]),a=r.commits.nodes[0].commit,e.next=39;break;case 32:return e.next=34,xe.graphql(Te(this.props.user,this.props.repo,this.props.commit_hash));case 34:if(null!=(p=e.sent).repository.object){e.next=38;break}return this.setState({error_message:"Failed to fetch ".concat(this.props.commit_hash)}),e.abrupt("return");case 38:a=p.repository.object.history.nodes[0];case 39:return(f=(f=a.checkSuites.nodes).filter((function(e){return e.workflowRun}))).forEach((function(e){e.checkRuns.nodes.forEach((function(e){e.log={text:null,shown:!1,logLevel:"Minimal"}}))})),e.next=44,he(f.map((function(e){return Object(u.a)(l.a.mark((function t(){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.workflowRun.databaseId,t.next=3,xe.json("repos/".concat(v.props.user,"/").concat(v.props.repo,"/actions/runs/").concat(n,"/artifacts"));case 3:e.artifacts=t.sent;case 4:case"end":return t.stop()}}),t)})))})));case 44:f=f.sort((function(e,t){return e.workflowRun.workflow.name.toUpperCase()>t.workflowRun.workflow.name.toUpperCase()?1:-1})),b=Object(N.a)(f);try{for(b.s();!(m=b.n()).done;)(j=m.value).status=this.mergeStatuses(j.checkRuns.nodes.map((function(e){return e.conclusion})))}catch(w){b.e(w)}finally{b.f()}return x=[],a.status&&(x=a.status.contexts),this.setState({pr:r,commit:a,runs:f,statuses:x,loadingNewCommit:!1,selectedCommit:a.oid}),g=this.state.runs.map((function(e){return e.s3_artifacts=[],"pytorch"!==v.props.repo?Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))):Object(u.a)(l.a.mark((function t(){var n,r,a,c,s,i,o,u,h,d,p;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ve("pytorch/pytorch/".concat(e.workflowRun.databaseId,"/"),"gha-artifacts");case 2:if(n=t.sent,!((r=v.extractItem(n.ListBucketResult,"CommonPrefixes"))&&r.length>0)){t.next=27;break}a=Object(N.a)(r),t.prev=6,a.s();case 8:if((c=a.n()).done){t.next=19;break}return s=c.value,i=s.Prefix["#text"],t.next=13,ve(i,"gha-artifacts");case 13:o=t.sent,u=v.extractItem(o.ListBucketResult,"Contents"),h=Object(N.a)(u);try{for(h.s();!(d=h.n()).done;)p=d.value,e.s3_artifacts.push(p)}catch(w){h.e(w)}finally{h.f()}case 17:t.next=8;break;case 19:t.next=24;break;case 21:t.prev=21,t.t0=t.catch(6),a.e(t.t0);case 24:return t.prev=24,a.f(),t.finish(24);case 27:case"end":return t.stop()}}),t,null,[[6,21,24,27]])})))})),e.next=53,he(g);case 53:this.setState(this.state);case 54:case"end":return e.stop()}var y,O,_}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderDocPreviewButton",value:function(){var e=this,t=null,n=null,r=function(t){var n,r=Object(N.a)(e.state.runs);try{for(r.s();!(n=r.n()).done;){var a,c=n.value,s=Object(N.a)(c.checkRuns.nodes);try{for(s.s();!(a=s.n()).done;){var i=a.value;if(i.name===t&&"COMPLETED"===i.status&&"SUCCESS"===i.conclusion)return!0}}catch(o){s.e(o)}finally{s.f()}}}catch(o){r.e(o)}finally{r.f()}return!1};return this.state.runs&&(r("build-docs (python)")&&(t=Object(x.jsx)("a",{href:"".concat(De,"/").concat(this.props.pr_number,"/index.html"),target:"_blank",className:"btn btn-primary",style:{marginRight:"5px"},rel:"noreferrer",children:"Python Docs"})),r("build-docs (cpp)")&&(n=Object(x.jsx)("a",{href:"".concat(De,"/").concat(this.props.pr_number,"/cppdocs/index.html"),target:"_blank",className:"btn btn-primary",rel:"noreferrer",children:"C++ Docs"}))),Object(x.jsxs)("div",{style:{paddingBottom:"5px"},children:[t,n]})}},{key:"renderTitle",value:function(){var e=null;if(this.state.commit)if(this.isPr())e=Object(x.jsx)("div",{children:Object(x.jsx)("h3",{children:Object(x.jsxs)("a",{href:"https://github.com/".concat(this.props.user,"/").concat(this.props.repo,"/pull/").concat(this.props.pr_number),children:[this.state.pr.title," (#",this.props.pr_number,")"]})})});else{var t=this.state.commit.messageHeadline,n=Object(x.jsx)("p",{children:t}),r=t.match(/\(#([\d]+)\)$/);if(r&&r[1]){var a=r[1];t=t.replace(r[0],""),n=Object(x.jsxs)("p",{children:[t," ",Object(x.jsxs)("a",{href:"https://github.com/".concat(this.props.user,"/").concat(this.props.repo,"/pull/").concat(a),children:["(#",a,")"]})]})}e=Object(x.jsxs)("div",{children:[Object(x.jsxs)("h2",{children:["Commit"," ",Object(x.jsx)("a",{href:this.state.commit.commitUrl,children:this.state.commit.oid.slice(0,7)})]}),n]})}return e}},{key:"findDiffInComments",value:function(e){var t,n=null,r=Object(N.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;if("facebook-github-bot"===a.author.login){var c=a.body.match(/https:\/\/www\.internalfb\.com\/diff\/(D\d+)/);c&&(n=c[1])}}}catch(s){r.e(s)}finally{r.f()}return n}},{key:"renderDiff",value:function(){if(!this.state.commit)return null;var e=this.state.commit.messageBody,t=null;this.isPr()&&(e=this.state.pr.body);var n=e.match(/Differential Revision: (\[)?(D\d+)(\])?/);return n&&(t=n[2]),!t&&this.isPr()&&(t=this.findDiffInComments(this.state.pr.comments.nodes)),Object(x.jsx)("a",{href:"https://www.internalfb.com/diff/".concat(t),children:t})}},{key:"renderBody",value:function(){if(!this.state.commit)return null;var e=this.state.commit.messageBody;return this.isPr()&&(e=this.state.pr.body),Object(x.jsx)("div",{style:{maxHeight:"13em",overflow:"scroll",margin:"10px"},children:Object(x.jsx)(Ee.a,{children:e})})}},{key:"getGroupRanges",value:function(e,t){var n,r=t.split("\n"),a=[],c=[],s=0,i=Object(N.a)(r);try{for(i.s();!(n=i.n()).done;){var o=n.value;o.includes("##[group]")?a.push(s):o.includes("##[endgroup]")&&c.push(s),s+=1}}catch(h){i.e(h)}finally{i.f()}for(var l=[],u=0;u<Math.min(a.length,c.length);u++)l.push({start:a[u]+1,end:c[u]+1,kind:e.languages.FoldingRangeKind.Imports});return l}},{key:"renderLogViewer",value:function(e){var t=this,n=null,r=!1;if(e.log.shown)if(r=!0,e.log.text){var a=null,c=((a="All"===e.log.logLevel?e.log.text:Se(e.log.text)).match(/\n/g)||"").length+1;e.log.existingEditor&&(e.log.existingEditor.setValue(a),e.log.existingEditor.revealLine(c)),n=Object(x.jsxs)("div",{style:{marginBottom:"20px"},children:[Object(x.jsxs)("div",{className:"hideRadio",children:[Object(x.jsx)("span",{children:"Log Level: "}),Object(x.jsx)("div",{style:{display:"inline"},children:Object(x.jsx)(re.a,{children:["Minimal","All"].map((function(n,r){return Object(x.jsx)(ae.a,{id:"radio-".concat(r),type:"radio",variant:"outline-info",name:"radio",value:n,checked:e.log.logLevel===n,onChange:function(r){e.log.logLevel=n,t.setState(t.state)},children:n},r)}))})})]}),Object(x.jsx)(ke.a,{height:"80vh",defaultLanguage:"logText",defaultValue:a,theme:"logTheme",beforeMount:function(e){Ce(e,t.getGroupRanges(e,a))},options:{scrollBeyondLastLine:!1,lineNumbersMinChars:c.toString().length+1,folding:!0},onMount:function(t,n){e.log.existingEditor=t,t.getAction("editor.foldAll").run().then((function(){t.revealLine(c)}))},loading:Object(x.jsx)("p",{children:"Loading viewer..."})})]})}else n=Object(x.jsx)("p",{children:"Fetching logs..."});return[n,r]}},{key:"getArtifactName",value:function(e){return e.replace("(","").replace(")","").replace("test ","test-reports-test-").replaceAll(", ","-")+".zip"}},{key:"renderChecks",value:function(e,t){var n=this,r=[],a={};t||(t=[]);var c,s={},i=Object(N.a)(t);try{for(i.s();!(c=i.n()).done;){var o=c.value,h=o.Key["#text"].split("/").slice(-1)[0];s[h]=o}}catch(b){i.e(b)}finally{i.f()}var d,p=Object(N.a)(e.entries());try{var f=function(){var e=Object(te.a)(d.value,2),t=e[0],c=e[1],i=function(){c.log.shown=!c.log.shown,n.setState(n.state)},o=n.renderLogViewer(c),h=Object(te.a)(o,2),p=h[0],f=h[1],b={cursor:"pointer"},m=Object(x.jsx)(F.b,{style:b,onClick:i});f&&(m=Object(x.jsx)(F.a,{style:b,onClick:i}));var j={SUCCESS:Object(x.jsx)(ie.a,{style:{color:"#22863a"}}),FAILURE:Object(x.jsx)(ie.d,{style:{color:"#cb2431"}}),NEUTRAL:Object(x.jsx)(ie.b,{style:{color:"#959da5"}}),CANCELLED:Object(x.jsx)(ie.b,{style:{color:"rgb(255 86 86)"}})}[c.conclusion]||Object(x.jsx)(ie.c,{style:{color:"#dbab09"}}),g=null,v=null,y=n.getArtifactName(c.name);if(s[y]){var O=s[y],_=le(parseInt(O.Size["#text"]));g=Object(x.jsx)("button",{style:{marginLeft:"5px",fontSize:"0.7em",fontWeight:"bold"},className:"btn btn-info",onClick:Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O.showReport?O.showReport=!1:O.showReport=!0,n.setState(n.state),n.render();case 3:case"end":return e.stop()}}),e)}))),children:O.showReport?"Hide":"Tests (".concat(_,")")}),a[O.Key["#text"]]=!0;var w=O.Key["#text"];if(c.artifactUrl="https://gha-artifacts.s3.amazonaws.com/".concat(w),c.artifact=O,O.showReport){var k="s3-".concat(c.name,"-").concat(y),S=O.Key["#text"],C="https://gha-artifacts.s3.amazonaws.com/".concat(S);v=Object(x.jsx)(we,{testReportZip:C},k)}}r.push({data:c,element:Object(x.jsxs)("div",{style:{marginBottom:"2px"},children:[j," ",Object(x.jsx)("a",{href:c.detailsUrl,children:c.name})," ",m," ",p,g,v]},"check-run-"+t)})};for(p.s();!(d=p.n()).done;)f()}catch(b){p.e(b)}finally{p.f()}return[r,a]}},{key:"renderArtifact",value:function(e){return e.expired?Object(x.jsxs)("div",{children:[Object(x.jsxs)("span",{children:["[",e.kind,"] ",e.name]})," ",Object(x.jsxs)("span",{children:["(",le(e.size_in_bytes),") (expired)"]})]},"".concat(e.kind,"-").concat(e.index)):Object(x.jsxs)("div",{children:[Object(x.jsxs)("a",{href:e.url,children:["[",e.kind,"] ",e.name]})," ",Object(x.jsxs)("span",{children:["(",le(e.size_in_bytes),")"]}),e.extra]},"".concat(e.kind,"-").concat(e.index))}},{key:"renderGitHubArtifacts",value:function(e){var t,n=[],r=Object(N.a)(e.artifacts.artifacts.entries());try{for(r.s();!(t=r.n()).done;){var a=Object(te.a)(t.value,2),c=a[0],s=a[1],i="https://github.com/".concat(this.props.user,"/").concat(this.props.repo,"/suites/").concat(e.databaseId,"/artifacts/").concat(s.id);s.name.startsWith("test-reports-")||n.push(this.renderArtifact({kind:"gha",index:c,name:s.name,size_in_bytes:s.size_in_bytes,url:i,expired:s.expired}))}}catch(o){r.e(o)}finally{r.f()}return n}},{key:"renderS3Artifacts",value:function(e,t){var n=[];if(e.s3_artifacts){var r,a=Object(N.a)(e.s3_artifacts.entries());try{for(a.s();!(r=a.n()).done;){var c=Object(te.a)(r.value,2),s=c[0],i=c[1];if(!t[i.Key["#text"]]){var o=i.Key["#text"],l="https://gha-artifacts.s3.amazonaws.com/".concat(o);n.push(this.renderArtifact({kind:"s3",index:s,name:o.split("/").slice(-1),size_in_bytes:parseInt(i.Size["#text"]),url:l,expired:!1}))}}}catch(u){a.e(u)}finally{a.f()}}return n}},{key:"mergeStatuses",value:function(e){if(0===e.length)return"SKIPPED";var t,n={FAILURE:0,NEUTRAL:0,CANCELLED:0,SUCCESS:0},r=Object(N.a)(e);try{for(r.s();!(t=r.n()).done;){n[t.value]+=1}}catch(a){r.e(a)}finally{r.f()}return n.FAILURE>0?"FAILURE":n.NEUTRAL+n.CANCELLED===e.length?"SKIPPED":n.SUCCESS===e.length?"SUCCESS":n.NEUTRAL===e.length?"SKIPPED":"PENDING"}},{key:"renderGroups",value:function(e){for(var t=this,n=[],r=function(){var e=Object(te.a)(c[a],2),r=e[0],s=e[1];if(!s.show)return"continue";var i=t.state.showGroups.includes(r),o=function(){t.state.showGroups.includes(r)?t.state.showGroups.pop(t.state.showGroups.indexOf(r)):t.state.showGroups.push(r),t.setState(t.state)},l=Object(x.jsx)(F.b,{style:{cursor:"pointer"},onClick:o}),u=[];i&&(l=Object(x.jsx)(F.a,{style:{cursor:"pointer"},onClick:o}),u=s.items);var h=Object(x.jsx)(ne.a,{children:Object(x.jsxs)(ne.a.Body,{children:[Object(x.jsxs)(ne.a.Title,{children:[r," ",l]}),u]})},"group-card-"+r);n.push({data:{status:"GROUP"},element:h})},a=0,c=Object.entries(e);a<c.length;a++)r();return n}},{key:"renderCommitSelector",value:function(){var e=this;if(!this.state.pr||!this.state.pr.allCommits||0===this.state.pr.allCommits.length)return null;var t,n=[],r=Object(N.a)(this.state.pr.allCommits);try{for(r.s();!(t=r.n()).done;){var a=Object(te.a)(t.value,2),c=a[0],s=a[1];n.push(Object(x.jsxs)("option",{value:c,children:[s," (",c.substring(0,7),")"]},"oid-".concat(c)))}}catch(o){r.e(o)}finally{r.f()}var i=null;return this.state.loadingNewCommit&&(i=Object(x.jsx)("span",{style:{marginLeft:"10px"},children:Object(x.jsx)(oe,{text:"Loading"})})),Object(x.jsxs)("div",{style:{margin:"4px"},children:[Object(x.jsx)("span",{children:Object(x.jsx)("a",{href:"https://github.com/pytorch/pytorch/commit/".concat(this.state.commit.oid),children:"Commit:"})}),Object(x.jsx)("select",{style:{marginLeft:"10px",borderRadius:"4px"},value:this.state.selectedCommit,onChange:function(){var t=Object(u.a)(l.a.mark((function t(n){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({loadingNewCommit:!0}),ge("prCommit",n.target.value),t.next=4,e.update({selectedCommit:n.target.value});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:n}),i]})}},{key:"render",value:function(){var e=[],t={"Add annotations":{},"Close stale pull requests":{},"Label PRs & Issues":{},Triage:{},"Update S3 HTML indices for download.pytorch.org":{}};if(Object.entries(t).forEach((function(e){e[1].show=!1,e[1].items=[]})),this.state.runs){var n,r=Object(N.a)(this.state.runs.entries());try{for(r.s();!(n=r.n()).done;){var a=Object(te.a)(n.value,2),c=a[0],s=a[1],i=this.renderChecks(s.checkRuns.nodes,s.s3_artifacts),o=Object(te.a)(i,2),l=o[0],u=o[1],h=l.map((function(e){return e.element})),d=[];s.artifacts&&(void 0!==s.artifacts.artifacts?d=d.concat(this.renderGitHubArtifacts(s)):d.push(Object(x.jsx)("div",{children:Object(x.jsx)("span",{children:"Can't query artifacts (hit GitHub rate limit)"})},"artifact-".concat(s.databaseId)))),d=d.concat(this.renderS3Artifacts(s,u));var p=Object(x.jsx)("div",{});d.length>0&&(p=Object(x.jsxs)("div",{style:{padding:"6px"},children:[Object(x.jsx)("h5",{children:"Artifacts"}),d]}));var f=Object(x.jsx)("div",{});h.length>0&&(f=Object(x.jsx)("div",{style:{padding:"6px"},children:h}));var b=s.workflowRun.workflow.name,m=Object(x.jsx)(ne.a,{children:Object(x.jsxs)(ne.a.Body,{style:{backgroundColor:"FAILURE"===s.status?"rgb(255 243 243)":null},children:[Object(x.jsx)(ne.a.Title,{children:Object(x.jsx)("a",{href:s.workflowRun.url,children:b})}),Object(x.jsxs)("div",{children:[f,p]})]})},"card-"+c);b in t?(t[b].show=!0,this.state.showGroups.includes(b)&&(t[b].show=!0,t[b].items.push(m))):e.push({data:s,element:m})}}catch(L){r.e(L)}finally{r.f()}}e=e.concat(this.renderGroups(t));var j=null;if(this.state.error_message?j=Object(x.jsxs)("p",{style:{color:"red"},children:[" ",this.state.error_message]}):this.state.commit||(j=Object(x.jsx)("p",{children:"Loading... (make sure you are signed in)"})),this.state.statuses){var g,v=Object(N.a)(this.state.statuses);try{for(v.s();!(g=v.n()).done;){var y=g.value;y.targetUrl.includes("https://circleci.com")&&(y.status=y.state,e.push({data:y,element:Object(x.jsx)(Re,{status:y},y.context)}))}}catch(L){v.e(L)}finally{v.f()}}var O=[];function _(t){var n,r=Object(N.a)(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.data.status===t&&(a.used=!0,O.push(Object(x.jsx)("div",{style:{marginBottom:"4px"},children:a.element},a.data.databaseId)))}}catch(L){r.e(L)}finally{r.f()}}_("FAILURE"),_("ERROR"),_("PENDING"),_("SUCCESS"),_("GROUP"),_("SKIPPED");var w,k=Object(N.a)(e);try{for(k.s();!(w=k.n()).done;){var S=w.value;S.used||console.error("Unused run with state",S.data.status)}}catch(L){k.e(L)}finally{k.f()}var C=e.filter((function(e){return"FAILURE"===e.data.status})),I=null;return C.length>0&&(I=Object(x.jsx)(Le,{user:this.props.user,repo:this.props.repo,failures:C})),this.state.runs&&0===O.length&&(O=Object(x.jsx)("p",{style:{fontWeight:"bold"},children:"No jobs found"})),Object(x.jsxs)("div",{children:[this.renderTitle(),this.renderDiff(),this.renderBody(),j,this.renderDocPreviewButton(),this.renderCommitSelector(),I,Object(x.jsx)("div",{children:O})]})}}]),n}(r.Component),Pe=(n(68),n(45)),Be=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={},r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.update()}},{key:"correlateJobs",value:function(e){var t,n=["success","skipped","pending","queued"],r={},a={},c=function(e,t){r[e]=!0,r[t]=!0,a[e]||(a[e]=[]),a[e][t]||(a[e][t]=0),a[e][t]+=1},s=Object(N.a)(e);try{for(s.s();!(t=s.n()).done;){var i=t.value,o=[];for(var l in i.value){var u=i.value[l];u.status&&-1===n.indexOf(u.status)&&o.push(l)}for(var h=0,d=o;h<d.length;h++){var p,f=d[h],b=Object(N.a)(o);try{for(b.s();!(p=b.n()).done;){c(f,p.value)}}catch(k){b.e(k)}finally{b.f()}}}}catch(k){s.e(k)}finally{s.f()}var m,j=Object.keys(r).sort(),x=[],g=Object(N.a)(j);try{for(g.s();!(m=g.n()).done;){var v,y=m.value,O=[],_=Object(N.a)(j);try{for(_.s();!(v=_.n()).done;){var w=v.value;a[y]&&a[y][w]?O.push(a[y][w]):O.push(0)}}catch(k){_.e(k)}finally{_.f()}x.push(O)}}catch(k){g.e(k)}finally{g.f()}return[j,x]}},{key:"update",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://ossci-job-status.s3.amazonaws.com/master",e.t0=JSON,e.next=4,fetch("".concat(t,"/index.json"),{cache:"no-cache"}).then((function(e){return e.text()}));case 4:return e.t1=e.sent,e.t2=e.t0.parse.call(e.t0,e.t1),n={job_index:e.t2},r=n.job_index.map((function(e){return fetch("".concat(t,"/").concat(e.id,".json")).then((function(e){return e.json()}))})),e.t3=this,e.next=11,Promise.allSettled(r);case 11:e.t4=e.sent,this.state.correlations=e.t3.correlateJobs.call(e.t3,e.t4),this.setState(n);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"tooltipTemplate",value:function(e,t,n){var r=n.background,a=e.data[0].label.split(", "),c=Object(te.a)(a,2),s=c[0],i=c[1];return'\n        <div\n        style="\n    background: '.concat(r,';\n    padding: 0 5px;\n    text-align: center;\n    color: white;">\n        <div\n        class="toastui-chart-tooltip-category"\n        style="font-weight: bold; font-family: Arial, sans-serif; font-size: 13px; color: #ffffff;">\n            ').concat(s,"\n            <br />\n            ").concat(i,'\n        </div>\n        <div\n        class="toastui-chart-tooltip-series-wrapper"\n        style="font-weight: normal; font-family: Arial, sans-serif; font-size: 12px; color: #ffffff;">\n            <div class="toastui-chart-tooltip-series">\n                <span class="toastui-chart-series-name">\n                <i class="toastui-chart-icon" style="background: ').concat(e.data[0].color,'"></i>\n                <span class="toastui-chart-name">').concat(e.data[0].value,"</span>\n                </span>\n            </div>\n        </div>\n    </div>\n    ")}},{key:"componentDidUpdate",value:function(){if(this.state.correlations){var e=document.getElementById("job-correlations"),t=Object(te.a)(this.state.correlations,2),n=t[0],r=t[1];e.innerHTML="";var a={usageStatistics:!1,xAxis:{label:{formatter:function(e,t){return""}}},yAxis:{label:{formatter:function(e,t){return""}}},tooltip:{template:this.tooltipTemplate}},c={categories:{x:n,y:n},series:r};Pe.a.heatmapChart({el:e,data:c,options:a})}}},{key:"render",value:function(){return Object(x.jsxs)("div",{children:[Object(x.jsx)("h2",{children:"CI Job Correlations"}),Object(x.jsx)("div",{id:"job-correlations",style:{width:"550px",height:"550px"}})]})}}]),n}(r.Component),Me=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={},r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.update()}},{key:"update",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,fetch("https://ossci-checks-status.s3.amazonaws.com/status.json",{cache:"no-cache"}).then((function(e){return e.text()}));case 3:e.t1=e.sent,e.t2=e.t0.parse.call(e.t0,e.t1),t={actions_statuses:e.t2},this.setState(t);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){if(this.state.actions_statuses){for(var e={dates:[]},t=["in_progress","queued","pending"],n=0,r=t;n<r.length;n++){e[r[n]]=[]}this.state.actions_statuses.sort((function(e,t){return e.last_updated-t.last_updated}));var a,c=Object(N.a)(this.state.actions_statuses);try{for(c.s();!(a=c.n()).done;){var s=a.value;e.dates.push(new Date(1e3*s.last_updated).toLocaleString());var i,o=Object(N.a)(t);try{for(o.s();!(i=o.n()).done;){var l=i.value;e[l].push(s[l]||0)}}catch(m){o.e(m)}finally{o.f()}}}catch(m){c.e(m)}finally{c.f()}for(var u=[],h=0,d=t;h<d.length;h++){var p=d[h];u.push({name:p,data:e[p]})}var f={categories:e.dates,series:u},b=document.getElementById("chart");b.innerHTML="";Pe.a.lineChart({el:b,data:f,options:{}})}}},{key:"render",value:function(){return Object(x.jsxs)("div",{children:[Object(x.jsx)("h2",{children:"GitHub Actions Status"}),Object(x.jsx)("div",{id:"chart",style:{width:"600px",height:"400px"}})]})}}]),n}(r.Component),Fe="#58c157",Ge="#e2b325",ze="#ff0504",He="#a3a3a3",Je="rgba(0, 0, 0, 0)",We=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={repos:[]},r.canvas=a.a.createRef(),r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.update()}},{key:"componentDidUpdate",value:function(){var e=this.canvas.current.getContext("2d");e.beginPath();var t,n={success:Fe,failure:ze,error:ze,neutral:He,cancelled:ze,pending:Ge,queued:Ge,unknown:Je},r=Object(N.a)(this.state.statuses.entries());try{for(r.s();!(t=r.n()).done;){var a,c=Object(te.a)(t.value,2),s=c[0],i=c[1],o=Object(N.a)(i.entries());try{for(o.s();!(a=o.n()).done;){var l=Object(te.a)(a.value,2),u=l[0],h=l[1],d=n[h];d||console.error("Unknown",h),e.fillStyle=d,e.fillRect(u,s,1,1)}}catch(p){o.e(p)}finally{o.f()}}}catch(p){r.e(p)}finally{r.f()}}},{key:"update",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n,r,a,c,s,i,o,u,h,d,p,f,b,m,j,x,g,v,y,O;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://s3.amazonaws.com/ossci-job-status/v5/".concat(this.props.user,"/").concat(this.props.repo,"/").concat(this.props.json),e.next=3,fetch(t);case 3:return n=e.sent,e.next=6,n.json();case 6:r=e.sent,a={},c=[],s=Object(N.a)(r);try{for(s.s();!(i=s.n()).done;){o=i.value,u={},h=Object(N.a)(o.jobs);try{for(h.s();!(d=h.n()).done;)p=d.value,a[p.name]=!0,u[p.name]=p}catch(l){h.e(l)}finally{h.f()}c.push(u)}}catch(l){s.e(l)}finally{s.f()}for((a=Object.keys(a)).sort(),f=[],b=0,m=c;b<m.length;b++){j=m[b],x=[],g=Object(N.a)(a);try{for(g.s();!(v=g.n()).done;)y=v.value,O="unknown",j[y]&&(O=j[y].status),x.push(O)}catch(l){g.e(l)}finally{g.f()}f.push(x)}this.setState({statuses:f});case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=null;return this.state.statuses&&this.state.statuses.length>0&&(e=Object(x.jsx)("canvas",{height:"100",width:this.state.statuses[0].length,ref:this.canvas})),Object(x.jsxs)("div",{style:{border:"1px solid #d2d2d2",borderRadius:"5px",padding:"10px",margin:"5px",display:"grid",gridTemplateRows:"3em auto",textAlign:"center"},children:[Object(x.jsxs)("span",{children:[Object(x.jsxs)("a",{href:"https://github.com/".concat(this.props.user,"/").concat(this.props.repo),children:[this.props.user,"/",this.props.repo]}),Object(x.jsx)("a",{style:{marginLeft:"5px"},href:"/ci/".concat(this.props.user,"/").concat(this.props.repo,"/").concat(this.props.branch),children:this.props.branch})]}),Object(x.jsx)("div",{children:Object(x.jsx)("a",{href:"/ci/".concat(this.props.user,"/").concat(this.props.repo,"/").concat(this.props.branch),children:e})})]})}}]),n}(r.Component),Ze=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={repos:[]},r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.update()}},{key:"s3ListBucket",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n,r,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ve(t,"ossci-job-status");case 2:return n=e.sent,r=[],n.ListBucketResult.CommonPrefixes&&(a=n.ListBucketResult.CommonPrefixes,Array.isArray(a)?r=r.concat(a.map((function(e){return e.Prefix.textContent}))):r.push(a.Prefix.textContent)),n.ListBucketResult.Contents&&(c=n.ListBucketResult.Contents,Array.isArray(c)?r=r.concat(c.map((function(e){return e.Key.textContent}))):r.push(c.Key.textContent)),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n,r,a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.s3ListBucket("v5/");case 2:return t=e.sent,n=t.map((function(e){return Object(u.a)(l.a.mark((function t(){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.s3ListBucket(e);case 2:return n=t.sent,t.next=5,Promise.all(n.map((function(e){return a.s3ListBucket(e)})));case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})))()})),e.next=6,Promise.all(n);case 6:r=e.sent,this.setState({repos:r.flat()});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e,t=[],n=Object(N.a)(this.state.repos);try{for(n.s();!(e=n.n()).done;){var r,a=e.value,c=a[0].match(/v5\/(.*)\/(.*)\//),s=c[1],i=c[2],o=Object(N.a)(a);try{for(o.s();!(r=o.n()).done;){var l=r.value.match(/v5\/.*\/.*\/(.*)/),u=l[1].replace("_","/").replace(".json","");t.push(Object(x.jsx)(We,{user:s,repo:i,branch:u,json:l[1]},"branch-".concat(i,"-").concat(u)))}}catch(h){o.e(h)}finally{o.f()}}}catch(h){n.e(h)}finally{n.f()}return Object(x.jsxs)("div",{children:[Object(x.jsx)("h4",{children:"PyTorch Org CI Overview"}),Object(x.jsxs)("p",{children:["Status roll up for PyTorch and domain libraries"," ",Object(x.jsx)(R.a,{overlay:"Each CI job for each branch in each repo corresponds to 1 pixel in the visualizations below",mouseLeaveDelay:0,placement:"rightTop",destroyTooltipOnHide:{keepParent:!1},children:Object(x.jsx)("span",{style:{color:"#a1a1a1",cursor:"pointer"},children:Object(x.jsx)(F.c,{})})},"help")]}),Object(x.jsx)("div",{style:{display:"flex",flexWrap:"wrap"},children:t})]})}}]),n}(r.Component),qe=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={loggedin:!!localStorage.getItem("gh_pat")},r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.update()}},{key:"update",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n,r,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new URL(window.location.href),n=t.searchParams.get("code")){e.next=4;break}return e.abrupt("return");case 4:return this.state.code=n,r="bad code passed to GitHub OAuth, sign into GitHub again",e.next=8,fetch("".concat("https://auth.pytorch.org","/authenticate/").concat(n)).then((function(e){return e.json()})).catch((function(e){return r="Error happened while communicating to auth server: "+e,{token:null}}));case 8:(a=e.sent).token?(localStorage.setItem("gh_pat",a.token),this.state.loggedin=!0):alert(r),this.setState(this.state),(c=localStorage.getItem("last_redirect"))&&(localStorage.removeItem("last_redirect"),c!==window.location.href&&(window.location.href=c));case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return localStorage.getItem("gh_pat")?Object(x.jsx)("div",{style:{display:"inline"},children:Object(x.jsx)("a",{href:"/github_logout",children:"log out"})}):this.state.code?Object(x.jsx)("div",{children:Object(x.jsx)("p",{children:"loading..."})}):Object(x.jsxs)("div",{style:{display:"inline"},children:[Object(x.jsx)("a",{href:"https://github.com/login/oauth/authorize?scope=public_repo&client_id=7e8b4df19d85405ac1b2",children:"log in"})," "]})}}]),n}(r.Component);var $e=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={sevs:[]},r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.update()}},{key:"update",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(localStorage.getItem("gh_pat")){e.next=3;break}return console.log("not logged in, can't fetch sevs"),e.abrupt("return");case 3:return e.next=5,xe.graphql_raw('\n      {\n        search(type:ISSUE,first:100,query:"is:open is:issue label:\\"ci: sev\\"") {\n          nodes {\n            ... on Issue {\n              number\n              title\n              body\n              url\n            }\n          }\n        }\n      }\n    ');case 5:if(!(t=e.sent).errors){e.next=10;break}return console.error("failed to fetch sevs"),console.error(t),e.abrupt("return");case 10:this.state.sevs=t.data.search.nodes,this.setState(this.state);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderSev",value:function(e){return Object(x.jsxs)("div",{className:"sevbox",children:[Object(x.jsx)("a",{href:"https://github.com/pytorch/pytorch/wiki/%5BWIP%5D-What-is-a-SEV",children:"SEV:"})," ",e.title," (",Object(x.jsxs)("a",{href:e.url,children:["#",e.number]}),")"]})}},{key:"render",value:function(){if(!window.location.href.includes("pytorch/pytorch"))return null;var e,t=this.state.sevs,n=[],r=Object(N.a)(t.entries());try{for(r.s();!(e=r.n()).done;){var a=Object(te.a)(e.value,2),c=a[0],s=a[1];n.push(Object(x.jsx)("div",{children:this.renderSev(s)},"sev-".concat(c)))}}catch(i){r.e(i)}finally{r.f()}return Object(x.jsx)("div",{children:n})}}]),n}(r.Component),Ve=n(79),Ke=n(46),Xe=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={showMore:!1},r}return Object(d.a)(n,[{key:"render",value:function(){var e=null;return this.state.showMore&&(e=null),Object(x.jsxs)("div",{className:"links-container",children:[Object(x.jsxs)("div",{className:"Links",children:[Object(x.jsxs)("div",{style:{display:"inline"},children:[Object(x.jsx)("a",{style:{fontWeight:"bold"},href:"https://hud.pytorch.org",children:"TVM CI HUD"}),Object(x.jsx)("ul",{style:{display:"inline"},className:"menu",children:["pytorch"].map((function(e){return Object(x.jsx)(r.Fragment,{children:["main","v0.5","v0.6","v0.7","v0.8"].map((function(e){return Object(x.jsx)("li",{children:Object(x.jsx)(Ke.b,{to:"/ci/apache/tvm/".concat(e),children:e})},"".concat(e))}))},e)}))})]}),Object(x.jsx)("div",{style:{display:"inline",marginLeft:"auto",marginRight:"0px"},children:Object(x.jsxs)("ul",{style:{marginBottom:"0"},className:"menu",children:[Object(x.jsx)("li",{children:Object(x.jsx)("a",{href:"https://github.com/pytorch/pytorch/wiki/Using-hud.pytorch.org",children:"help"})}),Object(x.jsx)("li",{children:Object(x.jsx)("a",{href:"https://github.com/pytorch/ci-hud/issues/new?assignees=&labels=&template=feature_request.yaml&title=%5Bfeature%5D%3A+",children:"requests"})}),Object(x.jsx)("li",{children:Object(x.jsx)(qe,{})}),Object(x.jsx)("li",{children:Object(x.jsx)("a",{style:{color:"black"},href:"https://github.com/pytorch/pytorch-ci-hud",children:Object(x.jsx)(Ve.a,{})})})]})})]}),e]})}}]),n}(r.Component),Qe=n(18),Ye=function(){return Object(x.jsxs)("div",{children:[Object(x.jsx)(Me,{}),Object(x.jsx)(Be,{}),Object(x.jsx)(C,{interval:1e3}),Object(x.jsx)(S,{interval:1e3})]})},et=function(){return Object(x.jsx)(qe,{})},tt=function(){return localStorage.removeItem("gh_pat"),console.log("logged out"),Object(x.jsx)(Qe.a,{to:"/"})},nt=function(e){var t=e.match,n=new URLSearchParams(window.location.search);return Object(x.jsx)(B,{interval:6e4,job:t.url.replace(/^\/build\//,""),mode:n.get("mode")})},rt=function(e){var t=e.match,n=new URLSearchParams(window.location.search);return Object(x.jsx)(B,{interval:6e4,job:t.url.replace(/^\/build1\//,""),mode:n.get("mode")})},at=function(e){var t=e.match;return Object(x.jsxs)("p",{children:["Route not found: ",t.url]})},ct=function e(t){var n=t.match;return Object(x.jsxs)(r.Fragment,{children:[Object(x.jsx)(Qe.b,{exact:!0,path:n.url,component:nt}),Object(x.jsx)(Qe.b,{path:"".concat(n.url,"/:segment"),component:e})]})},st=function e(t){var n=t.match;return Object(x.jsxs)(r.Fragment,{children:[Object(x.jsx)(Qe.b,{exact:!0,path:n.url,component:rt}),Object(x.jsx)(Qe.b,{path:"".concat(n.url,"/:segment"),component:e})]})},it=function(){return Object(x.jsx)(Ke.a,{basename:"/tvm-hud",children:Object(x.jsxs)("div",{className:"App",children:[Object(x.jsx)(Xe,{}),Object(x.jsxs)("div",{style:{margin:"0"},className:"container",children:[Object(x.jsx)($e,{}),Object(x.jsxs)(Qe.d,{children:[Object(x.jsx)(Qe.b,{path:"/build",component:ct}),Object(x.jsx)(Qe.b,{path:"/build1",component:st}),Object(x.jsx)(Qe.b,{path:"/apache/tvm/pull/:segment",render:function(e){return Object(x.jsx)(Qe.a,{to:"/pr/".concat(e.match.params.segment)})}}),Object(x.jsx)(Qe.b,{path:"/apache/tvm/pull/*/commits/:segment",render:function(e){return Object(x.jsx)(Qe.a,{to:"/commit/".concat(e.match.params.segment)})}}),Object(x.jsx)(Qe.b,{path:"/apache/tvm/commit/:segment",render:function(e){return Object(x.jsx)(Qe.a,{to:"/commit/".concat(e.match.params.segment)})}}),Object(x.jsx)(Qe.b,{path:"/ci/:user/:repo/:branch+",render:function(e){var t=new URLSearchParams(window.location.search),n=e.match.params;return Object(x.jsx)(ee,{interval:6e4,repo:n.repo,user:n.user,branch:n.branch,jobNameFilter:t.get("name_filter")})}}),Object(x.jsx)(Qe.b,{path:"/overview",render:function(){return Object(x.jsx)(Ze,{})}}),Object(x.jsx)(Qe.b,{path:"/pr/:user/:repo/:number",render:function(e){var t=e.match.params;return Object(x.jsx)(Ue,{pr_number:t.number,user:t.user,repo:t.repo})}}),Object(x.jsx)(Qe.b,{path:"/pr/:number",render:function(e){return Object(x.jsx)(Qe.a,{to:"/pr/apache/tvm/".concat(e.match.params.number)})}}),Object(x.jsx)(Qe.b,{path:"/commit/:user/:repo/:commit",render:function(e){var t=e.match.params;return Object(x.jsx)(Ue,{commit_hash:t.commit,user:t.user,repo:t.repo})}}),Object(x.jsx)(Qe.b,{path:"/commit/:commit",render:function(e){return Object(x.jsx)(Qe.a,{to:"/commit/apache/tvm/".concat(e.match.params.commit)})}}),Object(x.jsx)(Qe.b,{path:"/github_logout",component:tt}),Object(x.jsx)(Qe.b,{path:"/authorize_github",component:et}),Object(x.jsx)(Qe.b,{path:"/status",component:Ye}),Object(x.jsx)(Qe.b,{exact:!0,path:"/",children:Object(x.jsx)(Qe.a,{to:"/ci/apache/tvm/main"})}),Object(x.jsx)(Qe.b,{path:"*",exact:!0,component:at})]})]})]})})};s.a.render(Object(x.jsx)(it,{}),document.getElementById("root"))},87:function(e,t,n){},88:function(e,t,n){}},[[327,1,2]]]);
//# sourceMappingURL=main.2a0093f0.chunk.js.map